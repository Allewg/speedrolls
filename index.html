<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Epilogue:wght@400;500;600;700;800&amp;family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#b5352c",
                        "background-light": "#fdfdfc",
                        "background-dark": "#1a1a1a",
                        "accent-green": "#6B705C",
                        "matcha": "#6B705C",
                        "sakura-cream": "#fdfdf8",
                        "surface-light": "#ffffff",
                        "surface-dark": "#262626",
                        "card-bg": "#f4f1f1",
                    },
                    fontFamily: {
                        "display": ["Epilogue", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass-effect { backdrop-filter: blur(8px); background: rgba(255, 255, 255, 0.8); }
        .dark .glass-effect { background: rgba(26, 26, 26, 0.8); }
        .custom-scroll-hide::-webkit-scrollbar { display: none; }
        body { -webkit-tap-highlight-color: transparent; }
        .custom-shadow { box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        body { -webkit-font-smoothing: antialiased; }
        /* Custom toggle styling for Admin Panel */
        .toggle-checkbox:checked + .toggle-label {
            background-color: #6B705C; /* Matcha Green for On */
        }
        .toggle-checkbox:not(:checked) + .toggle-label {
            background-color: #b5352c; /* Azuki Red for Off */
        }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
    /* Estilos para el routing */
    .page {
      display: none;
    }
    .page.active {
      display: block;
    }
    /* Responsive: Desktop adaptations */
    @media (min-width: 1024px) {
      body {
        background: linear-gradient(to bottom, #fdfdfc, #f8f7f6);
      }
      .dark body {
        background: linear-gradient(to bottom, #1a1a1a, #0f0f0f);
      }
      .mobile-container {
        max-width: 900px !important;
        margin: 2rem auto;
      }
      .mobile-container-sm {
        max-width: 800px !important;
        margin: 2rem auto;
      }
      /* Ajustar grid de productos en desktop */
      .products-grid {
        grid-template-columns: repeat(3, 1fr) !important;
      }
      /* Ajustar filtros de categor√≠a en desktop: permitir wrap en m√∫ltiples filas */
      #categoryFiltersContainer {
        flex-wrap: wrap !important;
        overflow-x: visible !important;
        padding-bottom: 1rem !important;
      }
      #categoryFiltersContainer > div {
        flex-shrink: 0;
      }
      /* Ajustar carrusel en desktop */
      .hero-carousel {
        max-width: 100%;
        justify-content: flex-start;
        overflow-x: auto !important;
        scrollbar-width: thin;
        scrollbar-color: rgba(181, 53, 44, 0.3) transparent;
        padding-bottom: 0.5rem;
      }
      .hero-carousel::-webkit-scrollbar {
        height: 8px;
      }
      .hero-carousel::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 4px;
      }
      .hero-carousel::-webkit-scrollbar-thumb {
        background-color: rgba(181, 53, 44, 0.4);
        border-radius: 4px;
      }
      .hero-carousel::-webkit-scrollbar-thumb:hover {
        background-color: rgba(181, 53, 44, 0.6);
      }
      /* Ajustar contenedor interno del carrusel en desktop */
      .hero-carousel > div {
        gap: 1rem;
      }
      /* Ajustar slides del carrusel en desktop: mostrar 2 slides visibles */
      .hero-slide {
        min-width: calc(50% - 0.5rem) !important;
        max-width: calc(50% - 0.5rem) !important;
        flex: 0 0 calc(50% - 0.5rem) !important;
      }
      /* Footer fijo adaptado */
      .fixed-bottom-desktop {
        position: relative !important;
        margin-top: 2rem;
        border-radius: 1rem;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08), 0 8px 30px rgba(0, 0, 0, 0.12);
        padding-left: 1rem !important;
        padding-right: 1rem !important;
      }
      .fixed-bottom-desktop .space-y-3 > * + * {
        margin-top: 0.75rem;
      }
      /* Asegurar que el footer tenga el mismo ancho que el contenido del main */
      .fixed-bottom-desktop {
        width: calc(100% - 2rem);
      }
      /* El elemento Total debe tener exactamente el mismo ancho que los items del carrito */
      .fixed-bottom-desktop .lg\\:px-3 {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
      }
      /* Top bar adaptado */
      .fixed-top-desktop {
        position: sticky !important;
        top: 0;
        z-index: 50;
      }
      /* Ajustar espaciado en formularios */
      .form-section {
        max-width: 700px;
        margin: 0 auto;
      }
      /* Mejorar sombras en desktop */
      .shadow-2xl {
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      }
      /* Ajustar padding en desktop */
      .page {
        padding-bottom: 0 !important;
      }
    }
    @media (min-width: 768px) and (max-width: 1023px) {
      .mobile-container {
        max-width: 700px !important;
        margin: 1.5rem auto;
      }
      .mobile-container-sm {
        max-width: 650px !important;
        margin: 1.5rem auto;
      }
      .products-grid {
        grid-template-columns: repeat(2, 1fr) !important;
      }
      .form-section {
        max-width: 550px;
        margin: 0 auto;
      }
    }
  </style>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
  import { getDatabase, ref, set, get, onValue, off } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCAu96Nk2vciukH5L2PNP8IsaNz8cuxnlU",
    authDomain: "speedrolls.firebaseapp.com",
    databaseURL: "https://speedrolls-default-rtdb.firebaseio.com",
    projectId: "speedrolls",
    storageBucket: "speedrolls.firebasestorage.app",
    messagingSenderId: "721891301536",
    appId: "1:721891301536:web:c4e8146405ea12b13751c5",
    measurementId: "G-EFGM3FYB0F"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const database = getDatabase(app);

  // Hacer disponible globalmente
  window.firebaseDB = database;
  window.firebaseRef = ref;
  window.firebaseSet = set;
  window.firebaseGet = get;
  window.firebaseOnValue = onValue;
  window.firebaseOff = off;
  window.firebaseReady = true;
</script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-[#171212] dark:text-white antialiased">
<!-- Router Container -->
<div id="app"></div>

<!-- Pantalla 1: Home -->
<div id="page-home" class="page active">
<div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden max-w-[430px] lg:max-w-[900px] mobile-container shadow-2xl bg-background-light dark:bg-background-dark">
<!-- TopAppBar -->
<nav class="sticky top-0 z-50 flex items-center bg-background-light/90 dark:bg-background-dark/90 backdrop-blur-md p-4 justify-between border-b border-gray-100 dark:border-gray-800">
<div class="flex items-center gap-2">
<div class="bg-primary p-1.5 rounded-lg flex items-center justify-center text-white">
<span class="material-symbols-outlined text-[20px]">bolt</span>
</div>
<h1 class="text-[#171212] dark:text-white text-xl font-extrabold leading-tight tracking-tight">Speed Roll</h1>
</div>
<div class="flex gap-2">
<button class="flex size-10 items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
<span class="material-symbols-outlined text-[#171212] dark:text-white">search</span>
</button>
<button onclick="router.navigate('orders')" class="relative flex size-10 items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
<span class="material-symbols-outlined text-[#171212] dark:text-white">shopping_bag</span>
<span id="cartBadgeHome" class="absolute top-1 right-1 flex h-4 w-4 items-center justify-center rounded-full bg-primary text-[10px] font-bold text-white hidden"></span>
</button>
</div>
</nav>
<!-- Carousel / Hero Section -->
<div class="mt-4">
<div class="flex overflow-x-auto snap-x snap-mandatory hero-carousel">
<div class="flex items-stretch px-4 gap-4 w-full lg:w-auto">
<!-- Slide 1 -->
<div class="snap-center flex h-full flex-col gap-4 rounded-xl min-w-[320px] hero-slide relative group">
<div onclick="router.navigate('menu'); setTimeout(() => filterByCategory('promociones'), 100);" class="w-full aspect-[16/9] bg-center bg-no-repeat bg-cover rounded-xl flex flex-col justify-end p-5 overflow-hidden shadow-lg border border-gray-100 dark:border-gray-800 cursor-pointer hover:scale-[1.02] transition-transform" data-alt="Promociones especiales" id="promoHeroSlide" style='background-image: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0.7)), url("https://images.unsplash.com/photo-1571091718767-18b5b1457add?w=800&q=80");'>
<div class="bg-primary text-white text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded w-fit mb-2">Promoci√≥n</div>
<h3 class="text-white text-2xl font-bold leading-tight">Speed 1: 20% Descuento</h3>
<p class="text-gray-200 text-sm font-normal">Exclusivo primera orden en app</p>
</div>
</div>
<!-- Slide 2 -->
<div class="snap-center flex h-full flex-col gap-4 rounded-xl min-w-[320px] hero-slide relative group">
<div onclick="router.navigate('menu'); setTimeout(() => filterByCategory('Gohan'), 100);" class="w-full aspect-[16/9] bg-center bg-no-repeat bg-cover rounded-xl flex flex-col justify-end p-5 overflow-hidden shadow-lg border border-gray-100 dark:border-gray-800 cursor-pointer hover:scale-[1.02] transition-transform" data-alt="La Serie Gohan" style='background-image: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0.7)), url("https://lh3.googleusercontent.com/aida-public/AB6AXuCCq6Wl5L6ih_SYenl7cnJq4DBo8k8bhY7fRouHzFye_ey8i1QhlvHShgufsCn6ljTmUPGbXi_eU_4ElA3i-jYPzzO7-FTCLDDFP0YslWK5Yj6z7JXWMpjyPFJNTqNwkdU-ItaAjY8h9JsEdHq9LBpH-dhKtra5NbYes3Sj3RhAl636wpSvZeTm3VTHnuxZ6lOSfL5OGNmCJ7eM2_a83amhRbhf6hTbiqKQKrw2hkJI7UO9nC9JQmoKqBvXgEpAYyUAGjCwH8nVjuwO");'>
<div class="bg-accent-green text-white text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded w-fit mb-2">Nuevo</div>
<h3 class="text-white text-2xl font-bold leading-tight">La Serie Gohan</h3>
<p class="text-gray-200 text-sm font-normal">Platos frescos para el alma</p>
</div>
</div>
</div>
</div>
</div>
<!-- SectionHeader: Categories -->
<div class="flex items-center justify-between px-4 pt-8 pb-3">
<h3 class="text-[#171212] dark:text-white text-lg font-bold leading-tight tracking-tight">Categor√≠as del Men√∫</h3>
<button onclick="router.navigate('menu')" class="text-primary text-sm font-semibold">Ver Todo</button>
</div>
<!-- TextGrid: Categories with Icons -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-3 px-4" id="homeCategoriesContainer">
<!-- Las categor√≠as se generar√°n din√°micamente desde Firebase -->
</div>
<!-- Featured Section: Bento Style -->
<div class="px-4 py-8">
<h3 class="text-[#171212] dark:text-white text-lg font-bold leading-tight tracking-tight mb-4">Elecci√≥n del Chef</h3>
<div class="grid grid-cols-2 lg:grid-cols-4 grid-rows-2 lg:grid-rows-1 gap-3 h-[400px] lg:h-[300px]" id="chefChoiceContainer">
<!-- Los productos destacados se generar√°n din√°micamente desde Firebase -->
</div>
</div>
<!-- Sticky Bottom Area -->
<div class="sticky bottom-0 mt-auto bg-gradient-to-t from-background-light dark:from-background-dark via-background-light dark:via-background-dark to-transparent pt-10 pb-4 px-4">
<!-- SingleButton: Order Now -->
<div class="flex mb-4 lg:justify-center">
<button onclick="router.navigate('menu')" class="flex min-w-[84px] max-w-[480px] lg:max-w-[400px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-14 px-8 flex-1 lg:flex-none bg-primary text-white text-base font-bold leading-normal tracking-wide shadow-[0_8px_30px_rgb(181,53,44,0.3)] hover:brightness-110 active:scale-95 transition-all">
<span class="material-symbols-outlined mr-2">restaurant_menu</span>
<span class="truncate uppercase tracking-wider">Comenzar Pedido</span>
</button>
</div>
<!-- Custom Tab Bar -->
<div class="flex items-center justify-around bg-white/80 dark:bg-zinc-900/80 backdrop-blur-lg border border-gray-100 dark:border-gray-800 rounded-2xl h-16 shadow-lg">
<button onclick="router.navigate('home')" class="flex flex-col items-center gap-1 text-primary">
<span class="material-symbols-outlined font-variation-fill-1">home</span>
<span class="text-[10px] font-bold">Home</span>
</button>
<button onclick="router.navigate('menu')" class="flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500 hover:text-primary transition-colors">
<span class="material-symbols-outlined">menu_book</span>
<span class="text-[10px] font-medium">Men√∫</span>
</button>
<button onclick="router.navigate('orders')" class="flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500 hover:text-primary transition-colors">
<span class="material-symbols-outlined">receipt_long</span>
<span class="text-[10px] font-medium">Pedidos</span>
</button>
<button onclick="router.navigate('orders')" class="flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500 hover:text-primary transition-colors">
<span class="material-symbols-outlined">shopping_bag</span>
<span class="text-[10px] font-medium">Carrito</span>
</button>
</div>
</div>
<div class="h-6 bg-transparent"></div>
</div>
</div>

<!-- Pantalla 2: Menu -->
<div id="page-menu" class="page">
<div class="relative flex h-screen w-full flex-col overflow-hidden max-w-[430px] lg:max-w-[900px] mobile-container shadow-2xl border-x border-gray-100 dark:border-zinc-800 bg-background-light dark:bg-background-dark">
<!-- TopAppBar -->
<header class="flex items-center bg-background-light dark:bg-background-dark p-4 pb-2 justify-between z-10 sticky top-0">
<div class="flex size-12 shrink-0 items-center justify-start">
<span class="material-symbols-outlined text-2xl">search</span>
</div>
<div class="flex-1 text-center">
<h2 class="text-xl font-bold leading-tight tracking-tight uppercase italic">Speed Roll</h2>
</div>
<div class="flex w-12 items-center justify-end">
<button onclick="router.navigate('orders')" class="relative flex size-10 items-center justify-center rounded-full bg-primary/10 dark:bg-primary/20 text-primary">
<span class="material-symbols-outlined">shopping_basket</span>
<span id="cartBadgeMenu" class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-primary text-[10px] text-white font-bold hidden"></span>
</button>
</div>
</header>
<!-- Main Content Area -->
<main class="flex-1 overflow-y-auto no-scrollbar">
<!-- Hero Banner (Subtle Brand Touch) -->
<div class="px-4 py-2">
<div class="relative h-24 w-full rounded-xl bg-primary/5 dark:bg-primary/10 flex items-center px-6 overflow-hidden border border-primary/10">
<div class="z-10">
<h1 class="text-lg font-bold">Men√∫ Fusi√≥n</h1>
<p class="text-xs text-primary font-medium">Sushi encuentra Burger</p>
</div>
<div class="absolute right-[-20px] top-[-10px] opacity-10">
<span class="material-symbols-outlined text-[120px] rotate-12">restaurant</span>
</div>
</div>
</div>
<!-- Chips / Filter Carousel -->
<div class="flex gap-3 px-4 py-4 overflow-x-auto no-scrollbar sticky top-0 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-sm z-10" id="categoryFiltersContainer">
<!-- Los filtros de categor√≠as se generar√°n din√°micamente desde Firebase -->
</div>
<!-- ImageGrid / Menu Items -->
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4 p-4 products-grid" id="menuProductsContainer">
<!-- Los productos se cargar√°n din√°micamente desde Firebase -->
</div>
<div class="h-24"></div>
</main>
<!-- BottomNavBar -->
<nav class="absolute bottom-0 left-0 right-0 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-md border-t border-zinc-200 dark:border-zinc-800 px-4 pb-6 pt-2 flex items-center justify-around z-20">
<button onclick="router.navigate('home')" class="flex flex-1 flex-col items-center justify-center gap-1 text-zinc-400 dark:text-zinc-500">
<span class="material-symbols-outlined">home</span>
<p class="text-[10px] font-bold uppercase tracking-wider">Inicio</p>
</button>
<button onclick="router.navigate('menu')" class="flex flex-1 flex-col items-center justify-center gap-1 text-primary">
<span class="material-symbols-outlined font-fill">restaurant_menu</span>
<p class="text-[10px] font-bold uppercase tracking-wider">Men√∫</p>
</button>
<button onclick="router.navigate('orders')" class="flex flex-1 flex-col items-center justify-center gap-1 text-zinc-400 dark:text-zinc-500">
<span class="material-symbols-outlined">favorite</span>
<p class="text-[10px] font-bold uppercase tracking-wider">Guardados</p>
</button>
<button onclick="router.navigate('orders')" class="flex flex-1 flex-col items-center justify-center gap-1 text-zinc-400 dark:text-zinc-500">
<span class="material-symbols-outlined">shopping_bag</span>
<p class="text-[10px] font-bold uppercase tracking-wider">Carrito</p>
</button>
</nav>
</div>
</div>
<!-- Pantalla 4: Cart/Orders -->
<div id="page-orders" class="page">
<div class="relative flex min-h-screen w-full flex-col max-w-[430px] lg:max-w-[900px] mobile-container mx-auto overflow-x-hidden border-x border-gray-100 dark:border-zinc-800 shadow-2xl bg-background-light dark:bg-background-dark">
<!-- TopAppBar -->
<header class="sticky top-0 z-50 flex items-center bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md p-4 justify-between">
<button onclick="router.navigate('menu')" class="flex size-10 shrink-0 items-center justify-center rounded-full bg-gray-100 dark:bg-zinc-800 text-primary cursor-pointer">
<span class="material-symbols-outlined">arrow_back_ios_new</span>
</button>
<h2 class="text-[#171212] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-10">Tu Carrito</h2>
</header>
<main class="flex-1 px-4 pt-4 pb-40">
<!-- Promo Banner -->
<div class="mb-6 p-4 rounded-xl bg-primary/5 dark:bg-primary/10 border border-primary/20 flex items-center gap-3">
<span class="material-symbols-outlined text-primary">lightbulb</span>
<p class="text-sm font-medium text-primary">üí° Consumo Inteligente: Planifica tu pedido y aprovecha mejor tu compra</p>
</div>
<!-- Cart Items List -->
<div class="flex flex-col gap-4">
<!-- El carrito comienza vac√≠o -->
<!-- Suggestion Card -->
<div class="mt-4 p-4 rounded-xl border-2 border-dashed border-gray-200 dark:border-zinc-800 flex items-center justify-between">
<div class="flex items-center gap-3">
<div class="size-10 rounded-full bg-gray-100 dark:bg-zinc-800 flex items-center justify-center">
<span class="material-symbols-outlined text-zinc-400">add_shopping_cart</span>
</div>
<p class="text-sm font-medium text-zinc-500 dark:text-zinc-400">¬øQuieres agregar algo m√°s?</p>
</div>
<button onclick="router.navigate('menu')" class="text-primary text-sm font-bold">Ver Men√∫</button>
</div>
<!-- Salsas Adicionales Section -->
<div class="mt-6 p-4 rounded-xl bg-white dark:bg-zinc-900 shadow-sm border border-gray-50 dark:border-zinc-800">
<h3 class="text-[#171212] dark:text-white text-base font-bold mb-4 flex items-center gap-2">
<span class="material-symbols-outlined text-primary text-lg">water_drop</span>
Salsas Adicionales
</h3>
<div class="space-y-4">
<!-- Salsa Soya Extra -->
<div class="flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-background-dark">
<div class="flex items-center gap-3 flex-1">
<div class="w-10 h-10 rounded-lg bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center">
<span class="material-symbols-outlined text-amber-600 dark:text-amber-400">water_drop</span>
</div>
<div class="flex-1">
<p class="text-sm font-bold text-[#171212] dark:text-white">Salsa Soya Extra</p>
<p class="text-xs text-[#836967] dark:text-zinc-400">$500 c/u</p>
</div>
</div>
<div class="flex items-center gap-2">
<button onclick="updateExtraSauceQuantity('soya', -1, event)" class="flex h-8 w-8 items-center justify-center rounded-lg bg-gray-200 dark:bg-zinc-700 text-[#171212] dark:text-white hover:bg-gray-300 dark:hover:bg-zinc-600 transition-colors">
<span class="material-symbols-outlined text-sm">remove</span>
</button>
<input type="number" id="extraSauceSoyaQty" value="0" min="0" class="w-12 h-8 text-center text-sm font-bold border border-gray-200 dark:border-white/10 rounded-lg bg-white dark:bg-background-dark text-[#171212] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none"/>
<button onclick="updateExtraSauceQuantity('soya', 1, event)" class="flex h-8 w-8 items-center justify-center rounded-lg bg-primary text-white hover:bg-primary/90 transition-colors">
<span class="material-symbols-outlined text-sm">add</span>
</button>
</div>
</div>
<!-- Salsa Agridulce Extra -->
<div class="flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-background-dark">
<div class="flex items-center gap-3 flex-1">
<div class="w-10 h-10 rounded-lg bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center">
<span class="material-symbols-outlined text-orange-600 dark:text-orange-400">water_drop</span>
</div>
<div class="flex-1">
<p class="text-sm font-bold text-[#171212] dark:text-white">Salsa Agridulce Extra</p>
<p class="text-xs text-[#836967] dark:text-zinc-400">$500 c/u</p>
</div>
</div>
<div class="flex items-center gap-2">
<button onclick="updateExtraSauceQuantity('agridulce', -1, event)" class="flex h-8 w-8 items-center justify-center rounded-lg bg-gray-200 dark:bg-zinc-700 text-[#171212] dark:text-white hover:bg-gray-300 dark:hover:bg-zinc-600 transition-colors">
<span class="material-symbols-outlined text-sm">remove</span>
</button>
<input type="number" id="extraSauceAgridulceQty" value="0" min="0" class="w-12 h-8 text-center text-sm font-bold border border-gray-200 dark:border-white/10 rounded-lg bg-white dark:bg-background-dark text-[#171212] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none"/>
<button onclick="updateExtraSauceQuantity('agridulce', 1, event)" class="flex h-8 w-8 items-center justify-center rounded-lg bg-primary text-white hover:bg-primary/90 transition-colors">
<span class="material-symbols-outlined text-sm">add</span>
</button>
</div>
</div>
</div>
</div>
<!-- Observaciones del Cliente Section -->
<div class="mt-6 p-4 rounded-xl bg-white dark:bg-zinc-900 shadow-sm border border-gray-50 dark:border-zinc-800">
<h3 class="text-[#171212] dark:text-white text-base font-bold mb-4 flex items-center gap-2">
<span class="material-symbols-outlined text-primary text-lg">note</span>
Observaciones del Cliente
</h3>
<div class="flex flex-col w-full">
<p class="text-[#171212] dark:text-gray-300 text-sm font-medium leading-normal pb-1.5 px-1 mb-2">Agrega instrucciones especiales o comentarios sobre tu pedido</p>
<textarea id="customerObservations" rows="3" class="form-input flex w-full rounded-lg text-[#171212] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-background-dark h-24 placeholder:text-gray-400 dark:placeholder:text-gray-500 p-[15px] text-base font-normal resize-none" placeholder="Ej: Sin cebolla, sin picante, entrega urgente, etc."></textarea>
</div>
</div>
</main>
<!-- Fixed Bottom Order Summary & Checkout -->
<footer class="fixed lg:sticky bottom-0 left-0 right-0 max-w-[430px] lg:max-w-[900px] mx-auto bg-white/90 dark:bg-background-dark/90 backdrop-blur-xl p-6 lg:p-4 lg:pt-6 custom-shadow rounded-t-[2rem] lg:rounded-2xl border-t border-gray-100 dark:border-zinc-800 fixed-bottom-desktop">
<!-- DescriptionList: Summary -->
<div class="space-y-3 mb-6 lg:mb-6">
<div class="flex justify-between items-center">
<p class="text-[#836967] dark:text-zinc-400 text-sm lg:text-base font-medium leading-normal">Subtotal</p>
<p class="text-[#171212] dark:text-white text-sm lg:text-base font-bold leading-normal text-right">$0.00</p>
</div>
<div class="flex justify-between items-center">
<p class="text-[#836967] dark:text-zinc-400 text-sm lg:text-base font-medium leading-normal">Env√≠o Estimado</p>
<div class="flex items-center gap-1">
<p class="text-[#171212] dark:text-white text-sm lg:text-base font-bold leading-normal text-right">$0.00</p>
</div>
</div>
<div class="h-px bg-gray-100 dark:bg-zinc-800 w-full my-1 lg:my-2"></div>
<!-- DescriptionList: Total -->
<div class="flex justify-between items-center lg:py-3 lg:px-3 lg:bg-white lg:dark:bg-zinc-900 lg:rounded-xl lg:shadow-sm lg:border lg:border-gray-50 lg:dark:border-zinc-800">
<p class="text-[#171212] dark:text-white text-lg lg:text-xl font-bold leading-normal">Total</p>
<p class="text-primary text-2xl lg:text-3xl font-bold leading-normal text-right">$0.00</p>
</div>
</div>
<div>
<button onclick="router.navigate('checkout')" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 lg:py-5 px-6 rounded-xl lg:rounded-2xl shadow-lg shadow-primary/25 hover:shadow-xl hover:shadow-primary/30 flex items-center justify-center gap-3 transition-all active:scale-[0.98] lg:text-lg lg:font-extrabold">
<span>Confirmar Pedido</span>
<span class="material-symbols-outlined lg:text-xl">arrow_forward</span>
</button>
</div>
<!-- Home Indicator (iOS style) - oculto en desktop -->
<div class="w-32 h-1 bg-gray-200 dark:bg-zinc-800 mx-auto mt-6 lg:hidden rounded-full"></div>
</footer>
</div>
</div>
<!-- Pantalla 5: Checkout/Profile -->
<div id="page-checkout" class="page">
<div class="bg-background-light dark:bg-background-dark text-[#171212] dark:text-white min-h-screen">
<div class="max-w-[480px] lg:max-w-[900px] mobile-container mx-auto min-h-screen flex flex-col relative pb-32 lg:pb-8 shadow-2xl">
<!-- TopAppBar -->
<div class="sticky top-0 z-50 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md">
<div class="flex items-center p-4 justify-between">
<button onclick="router.navigate('orders')" class="text-[#171212] dark:text-white flex size-12 shrink-0 items-center justify-center hover:bg-gray-100 dark:hover:bg-white/10 rounded-full transition-colors">
<span class="material-symbols-outlined">arrow_back_ios_new</span>
</button>
<h2 class="text-[#171212] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12">Pago</h2>
</div>
<!-- PageIndicators (Progress) -->
<div class="flex w-full flex-row items-center justify-center gap-3 py-2">
<div class="h-1.5 w-8 rounded-full bg-primary"></div>
<div class="h-1.5 w-8 rounded-full bg-primary/20 dark:bg-primary/10"></div>
<div class="h-1.5 w-8 rounded-full bg-primary/20 dark:bg-primary/10"></div>
</div>
</div>
<!-- Main Form Container -->
<div class="px-4 lg:px-8 space-y-6 form-section">
<!-- Contact Information Section -->
<section class="bg-surface-light dark:bg-surface-dark rounded-xl p-4 shadow-sm border border-gray-100 dark:border-white/5">
<div class="flex items-center gap-2 mb-4">
<span class="material-symbols-outlined text-primary text-xl">person</span>
<h3 class="text-[#171212] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">Informaci√≥n de Contacto</h3>
</div>
<div class="space-y-4">
<!-- TextField: Full Name -->
<div class="flex flex-col w-full">
<p class="text-[#171212] dark:text-gray-300 text-sm font-medium leading-normal pb-1.5 px-1">Nombre Completo</p>
<input id="fullName" class="form-input flex w-full rounded-lg text-[#171212] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-background-dark h-14 placeholder:text-gray-400 dark:placeholder:text-gray-500 p-[15px] text-base font-normal" placeholder="Juan P√©rez" value=""/>
</div>
</div>
</section>
<!-- Medio de Pago Section -->
<section class="bg-surface-light dark:bg-surface-dark rounded-xl p-4 shadow-sm border border-gray-100 dark:border-white/5">
<div class="flex items-center gap-2 mb-4">
<span class="material-symbols-outlined text-primary text-xl">payments</span>
<h3 class="text-[#171212] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">Medio de Pago</h3>
</div>
<div class="flex flex-col w-full">
<p class="text-[#171212] dark:text-gray-300 text-sm font-medium leading-normal pb-1.5 px-1 mb-2">Selecciona el medio de pago</p>
<select id="paymentMethod" class="form-input flex w-full rounded-lg text-[#171212] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-background-dark h-14 px-[15px] text-base font-normal appearance-none cursor-pointer" style="background-image: url('data:image/svg+xml;charset=UTF-8,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 12 12%27%3E%3Cpath fill=%27%23333%27 d=%27M6 9L1 4h10L6 9z%27/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 1rem center; background-size: 12px; padding-right: 2.5rem;">
<option value="efectivo">Efectivo</option>
<option value="tarjeta">Tarjeta</option>
<option value="transferencia">Transferencia</option>
</select>
</div>
</section>
<!-- Retiro o Despacho Section -->
<section class="bg-surface-light dark:bg-surface-dark rounded-xl p-4 shadow-sm border border-gray-100 dark:border-white/5">
<div class="flex items-center gap-2 mb-4">
<span class="material-symbols-outlined text-primary text-xl">local_shipping</span>
<h3 class="text-[#171212] dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">Retiro o Despacho</h3>
</div>
<!-- Custom Segmented Control -->
<div class="flex p-1 bg-gray-100 dark:bg-background-dark rounded-lg mb-4">
<button onclick="toggleDeliveryOption('retiro')" id="btnRetiro" class="flex-1 py-2 px-3 bg-white dark:bg-surface-dark rounded-md shadow-sm text-sm font-bold text-primary">Retiro en Local</button>
<button onclick="toggleDeliveryOption('despacho')" id="btnDespacho" class="flex-1 py-2 px-3 rounded-md text-sm font-medium text-gray-500 dark:text-gray-400">Despacho</button>
</div>
<!-- Address Field (only shown when despacho is selected) -->
<div id="deliveryAddressSection" class="hidden">
<div class="flex flex-col w-full mb-4">
<p class="text-[#171212] dark:text-gray-300 text-sm font-medium leading-normal pb-1.5 px-1">Direcci√≥n de Despacho</p>
<textarea id="deliveryAddress" class="form-input flex w-full rounded-lg text-[#171212] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-background-dark h-20 placeholder:text-gray-400 dark:placeholder:text-gray-500 p-[15px] text-base font-normal resize-none" placeholder="Ingresa tu direcci√≥n completa..." rows="3"></textarea>
</div>
<div class="flex items-center justify-between p-3 bg-primary/5 dark:bg-primary/10 rounded-lg border border-primary/20">
<span class="text-sm font-medium text-[#171212] dark:text-white">Costo de Despacho</span>
<span class="text-lg font-bold text-primary">$3.000</span>
</div>
</div>
</section>
</div>
<!-- Bottom CTA Bar -->
<div class="fixed lg:sticky bottom-0 left-0 right-0 max-w-[480px] lg:max-w-[900px] mx-auto bg-background-light dark:bg-background-dark border-t border-gray-100 dark:border-white/5 p-4 pb-8 lg:pb-4 z-50 fixed-bottom-desktop">
<!-- Salsas Section -->
<div class="mb-4 p-3 bg-gray-50 dark:bg-zinc-900/50 rounded-lg border border-gray-200 dark:border-white/5">
<p class="text-xs font-bold text-[#171212] dark:text-white mb-2 flex items-center gap-1">
<span class="material-symbols-outlined text-primary text-sm">water_drop</span>
Salsas Seleccionadas
</p>
<div id="checkoutSaucesSection" class="text-xs text-gray-400 dark:text-gray-500">
<p>No hay salsas seleccionadas</p>
</div>
</div>
<div class="flex justify-between items-end mb-4 px-1">
<div>
<p class="text-xs text-gray-500 dark:text-gray-400 font-medium">Total del Pedido</p>
<div class="flex items-baseline gap-1">
<p id="checkoutTotal" class="text-2xl font-bold text-[#171212] dark:text-white">$0.00</p>
<p class="text-xs text-gray-400 dark:text-gray-500 line-through">$48.00</p>
</div>
</div>
</div>
<button onclick="handlePayment()" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 rounded-xl shadow-lg shadow-primary/20 transition-all active:scale-[0.98] flex items-center justify-center gap-2">
<span>Confirmar Pedido</span>
<span class="material-symbols-outlined">arrow_forward</span>
</button>
</div>
</div>
</div>
</div>

<!-- Pantalla Profile (placeholder) -->
<div id="page-profile" class="page"></div>
<!-- Pantalla 7: Admin Login -->
<div id="page-admin-login" class="page">
<div class="bg-background-light dark:bg-background-dark text-[#171212] dark:text-white min-h-screen flex items-center justify-center">
<div class="max-w-[480px] lg:max-w-[600px] mobile-container mx-auto px-6 py-12">
<!-- Login Icon -->
<div class="flex justify-center mb-8">
<div class="size-24 rounded-full bg-primary/10 dark:bg-primary/20 flex items-center justify-center">
<span class="material-symbols-outlined text-primary text-6xl">lock</span>
</div>
</div>
<!-- Login Form -->
<div class="text-center mb-8">
<h1 class="text-[#171212] dark:text-white text-3xl lg:text-4xl font-extrabold leading-tight mb-4">Panel de Administraci√≥n</h1>
<p class="text-[#836967] dark:text-zinc-400 text-base lg:text-lg leading-relaxed mb-6">
Ingresa el c√≥digo de acceso para continuar
</p>
<!-- Login Card -->
<div class="bg-white dark:bg-zinc-900 rounded-2xl p-6 shadow-lg border border-gray-100 dark:border-zinc-800 mb-8">
<div class="space-y-4">
<div class="flex flex-col w-full">
<label class="text-[#171212] dark:text-gray-300 text-sm font-medium leading-normal pb-1.5 px-1 mb-2">C√≥digo de Acceso</label>
<input id="adminCode" type="password" class="form-input flex w-full rounded-lg text-[#171212] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-background-dark h-14 placeholder:text-gray-400 dark:placeholder:text-gray-500 p-[15px] text-base font-normal text-center tracking-widest" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="6" autocomplete="off"/>
<p id="adminCodeError" class="text-xs text-red-500 mt-2 hidden">C√≥digo incorrecto. Intenta nuevamente.</p>
</div>
<button onclick="handleAdminLogin()" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 px-6 rounded-xl shadow-lg shadow-primary/25 hover:shadow-xl hover:shadow-primary/30 flex items-center justify-center gap-3 transition-all active:scale-[0.98] text-base">
<span class="material-symbols-outlined">login</span>
<span>Acceder</span>
</button>
</div>
</div>
<!-- Back Button -->
<button onclick="router.navigate('home')" class="w-full bg-white dark:bg-zinc-900 hover:bg-gray-50 dark:hover:bg-zinc-800 text-[#171212] dark:text-white font-bold py-4 px-6 rounded-xl border-2 border-gray-200 dark:border-zinc-700 flex items-center justify-center gap-3 transition-all active:scale-[0.98] text-base">
<span class="material-symbols-outlined">arrow_back</span>
<span>Volver al Inicio</span>
</button>
</div>
</div>
</div>
</div>
<!-- Pantalla 8: Admin Panel -->
<div id="page-admin" class="page">
<div class="bg-background-light dark:bg-background-dark text-[#171212] dark:text-white min-h-screen">
<div class="max-w-md mx-auto">
<!-- TopAppBar -->
<header class="sticky top-0 z-50 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md border-b border-gray-100 dark:border-gray-800">
<div class="flex items-center p-4 justify-between">
<div class="flex items-center gap-3">
<span class="material-symbols-outlined text-primary" style="font-size: 28px;">restaurant_menu</span>
<h1 class="font-display text-xl font-bold tracking-tight text-primary uppercase">Speed Roll</h1>
</div>
<div class="flex gap-2">
<button onclick="router.navigate('home')" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800">
<span class="material-symbols-outlined text-[#171212] dark:text-white">logout</span>
</button>
</div>
</div>
</header>
<main class="pb-24">
<!-- Filter Chips -->
<div class="flex gap-2 p-4 overflow-x-auto no-scrollbar">
<div class="flex h-9 shrink-0 items-center justify-center rounded-full bg-primary px-5 shadow-md">
<p class="text-white text-sm font-semibold">Todos</p>
</div>
<div class="flex h-9 shrink-0 items-center justify-center rounded-full bg-card-bg dark:bg-gray-800 px-5 border border-gray-200 dark:border-gray-700">
<p class="text-sm font-medium">Sushi Burgers</p>
</div>
<div class="flex h-9 shrink-0 items-center justify-center rounded-full bg-card-bg dark:bg-gray-800 px-5 border border-gray-200 dark:border-gray-700">
<p class="text-sm font-medium">Rolls Fusion</p>
</div>
<div class="flex h-9 shrink-0 items-center justify-center rounded-full bg-card-bg dark:bg-gray-800 px-5 border border-gray-200 dark:border-gray-700">
<p class="text-sm font-medium">Bebidas</p>
</div>
</div>
<!-- Section Header -->
<div class="flex items-center justify-between px-4 pt-4">
<h3 class="font-display text-lg font-bold">Men√∫ de Cocina</h3>
<span id="adminItemsCount" class="text-xs font-bold text-gray-400">6 ITEMS TOTALES</span>
</div>
<!-- Inventory List -->
<div id="adminInventoryList" class="space-y-2 p-4">
<!-- Items se generar√°n din√°micamente -->
<div class="flex items-center gap-4 bg-white dark:bg-gray-900 rounded-xl p-3 shadow-sm border border-gray-100 dark:border-gray-800">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-16 shrink-0" data-alt="Gourmet salmon fusion burger with avocado and spicy mayo" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCg5JQNXYckZH8QYZRHabWWn_enZI-XhBVuRuPECiD6ooczH38Rd9RBhtis0cmHGUZZAILYTOXOzPuoQxlbIJtIWAd2wC9urJhLZkJs370t38ip56EoT5tBhk33oT9YHmjnW7SbNaKB7jL-qxyZ8XZ2nlBIIfqOc3fiS0XwJiK-z4eE7LK-heRrDYJr7BJW8wbHFi-lvRNsTeED6NHQoRVnez2y_zt4xiL_Jwdy5pr7FgDybpJRUhRdzTShNi4cvMoFFSkSDq44BG8w");'></div>
<div class="flex flex-col flex-1 min-w-0">
<p class="font-display text-base font-bold truncate">Salmon Fusion Burger</p>
<p class="text-gray-500 text-sm">$18.50 ‚Ä¢ Plato Principal</p>
<p class="text-accent-green text-xs font-bold mt-1 uppercase tracking-tighter">En Stock</p>
</div>
<div class="shrink-0">
<label class="relative flex h-[34px] w-[60px] cursor-pointer items-center rounded-full p-1 transition-colors duration-300 toggle-label bg-accent-green">
<input checked="" class="invisible absolute toggle-checkbox peer" type="checkbox" onchange="toggleItemStock(this)"/>
<div class="h-full w-[26px] rounded-full bg-white transition-all peer-checked:translate-x-[26px]" style="box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
</label>
</div>
</div>
<!-- Item 2 -->
<div class="flex items-center gap-4 bg-white dark:bg-gray-900 rounded-xl p-3 shadow-sm border border-gray-100 dark:border-gray-800">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-16 shrink-0" data-alt="Crispy tuna tempura roll with sesame seeds" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCyCmzDG7dqa8zRIuuiRV7Z_FX2d-yEnnV1B23iDqH2geNMpYu-PxC9wxPQz_FtoDv2B8-ObcUem2BqxrSVb7dQpBbH82u-Ve_A-QEpLtkFSS6dbQzG3IG4J8TRUYRBzlTu4GIveEJDqIXIX34XC3sa4U_ZbcWLmhaxAdgUEYqPCg3qW8ZS-6XjD4BER7GA37qb9aYDjTmeji6ETHncNOORFFuXv5BMyiaAL0mo8q8QJGb7ijbvTi4sk02HN9zH6eQETohlb6aNkSC3");'></div>
<div class="flex flex-col flex-1 min-w-0 opacity-60">
<p class="font-display text-base font-bold truncate">Tuna Tempura Roll</p>
<p class="text-gray-500 text-sm">$14.20 ‚Ä¢ Sushi</p>
<p class="text-primary text-xs font-bold mt-1 uppercase tracking-tighter">Agotado</p>
</div>
<div class="shrink-0">
<label class="relative flex h-[34px] w-[60px] cursor-pointer items-center rounded-full p-1 transition-colors duration-300 toggle-label bg-primary">
<input class="invisible absolute toggle-checkbox peer" type="checkbox" onchange="toggleItemStock(this)"/>
<div class="h-full w-[26px] rounded-full bg-white transition-all peer-checked:translate-x-[26px]" style="box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
</label>
</div>
</div>
<!-- Item 3 -->
<div class="flex items-center gap-4 bg-white dark:bg-gray-900 rounded-xl p-3 shadow-sm border border-gray-100 dark:border-gray-800">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-16 shrink-0" data-alt="Crispy shrimp ebi burger with wasabi slaw" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCb_l9YLIrvQaYzjwvSczQZrH_P0fvEWUcVZM-vXE111SSGTlXk6E1tJs9lxBYj_0bBkvAdDhKC344S_8lF1PMjh1XZPGEKWsb2IvZ8r_e7CuVNWiRnezt7MFUvI6wXZeoGOl1wAKgWppVxbz2aDWmE9OOh6x-q-8cwA9r2hXBBA9ON3xtKb-zenvFlBxpcQaUS9glKSiMZgQsUsbsWgUZkz9wsNPKso5A_kFYm4E_WvGZVrK7w1c0Q_DXJi4iHK6DnuDUDRGi7RuzR");'></div>
<div class="flex flex-col flex-1 min-w-0">
<p class="font-display text-base font-bold truncate">Ebi Crunch Burger</p>
<p class="text-gray-500 text-sm">$16.00 ‚Ä¢ Plato Principal</p>
<p class="text-accent-green text-xs font-bold mt-1 uppercase tracking-tighter">En Stock</p>
</div>
<div class="shrink-0">
<label class="relative flex h-[34px] w-[60px] cursor-pointer items-center rounded-full p-1 transition-colors duration-300 toggle-label bg-accent-green">
<input checked="" class="invisible absolute toggle-checkbox peer" type="checkbox" onchange="toggleItemStock(this)"/>
<div class="h-full w-[26px] rounded-full bg-white transition-all peer-checked:translate-x-[26px]" style="box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
</label>
</div>
</div>
<!-- Item 4 -->
<div class="flex items-center gap-4 bg-white dark:bg-gray-900 rounded-xl p-3 shadow-sm border border-gray-100 dark:border-gray-800">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-16 shrink-0" data-alt="Dragon roll with eel and cucumber" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDY1YTUMydsyj47lTNxWvYG7tv9fmu-FsWYr9XbsOiSQ8J0ZdsA6VoAqv-ATL8X7mwsFdSV3UiS-4xeQsDFV-kS2CwIF_-_3SMqiu2JuYqedPzvJFe7u1VZE6DLfuk-xIJyYbKD7KitzGQCgmxZz-OsN5L04byq--dERPV_vokPpl2lbOZzcjZGfQEYBqUQterVEd8iwJ0lVgxoHLpSGw_uDV5fUKzzQO4Fr5__9-ssQxzVs7bBo9RR63y-8PKoJT_gH8hdHYXJMBCw");'></div>
<div class="flex flex-col flex-1 min-w-0">
<p class="font-display text-base font-bold truncate">Green Dragon Roll</p>
<p class="text-gray-500 text-sm">$15.50 ‚Ä¢ Sushi</p>
<p class="text-accent-green text-xs font-bold mt-1 uppercase tracking-tighter">En Stock</p>
</div>
<div class="shrink-0">
<label class="relative flex h-[34px] w-[60px] cursor-pointer items-center rounded-full p-1 transition-colors duration-300 toggle-label bg-accent-green">
<input checked="" class="invisible absolute toggle-checkbox peer" type="checkbox" onchange="toggleItemStock(this)"/>
<div class="h-full w-[26px] rounded-full bg-white transition-all peer-checked:translate-x-[26px]" style="box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
</label>
</div>
</div>
<!-- Item 5 -->
<div class="flex items-center gap-4 bg-white dark:bg-gray-900 rounded-xl p-3 shadow-sm border border-gray-100 dark:border-gray-800 opacity-70">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-16 shrink-0" data-alt="Japanese matcha latte drink" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDXGGU1VKz5UjUV4o9KrXg1Z6Rl8YCo8hOzoiRwxLbyfgMBmp-eyD607-V9miOjxxj9OKBilP4RUg1X7fYzbMQsctvpa8-lcOxSnJHjvuF_DukSgQXa-1bhodltH8PD-vu3V50P06QWBylJv7HAmCwHr-_5JZmG3SR2idWt1jNsXAs-Z9pSKY6JKnAazp8sedHD6dzpAZP7yBmfNkShDfHwFb8ppUFzJS4ZH4FW_shzOedFhPIPWo04FPzAzj1XJfBJ5aQBAQaOUpu-");'></div>
<div class="flex flex-col flex-1 min-w-0 opacity-60">
<p class="font-display text-base font-bold truncate">Iced Matcha Latte</p>
<p class="text-gray-500 text-sm">$6.50 ‚Ä¢ Bebidas</p>
<p class="text-primary text-xs font-bold mt-1 uppercase tracking-tighter">Agotado</p>
</div>
<div class="shrink-0">
<label class="relative flex h-[34px] w-[60px] cursor-pointer items-center rounded-full p-1 transition-colors duration-300 toggle-label bg-primary">
<input class="invisible absolute toggle-checkbox peer" type="checkbox" onchange="toggleItemStock(this)"/>
<div class="h-full w-[26px] rounded-full bg-white transition-all peer-checked:translate-x-[26px]" style="box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
</label>
</div>
</div>
</div>
</main>
<!-- Floating Action Button -->
<div class="fixed bottom-24 right-8 z-50">
<button class="flex items-center justify-center size-14 rounded-xl bg-primary text-white shadow-lg active:scale-95 transition-transform">
<span class="material-symbols-outlined" style="font-size: 32px;">add</span>
</button>
</div>
<!-- Navigation Bar (iOS Style) -->
<nav class="fixed bottom-0 left-0 right-0 bg-white/95 dark:bg-gray-900/95 backdrop-blur-md border-t border-gray-100 dark:border-gray-800 px-6 py-3 flex justify-center items-center z-40 max-w-md mx-auto">
<div class="flex flex-col items-center gap-1 text-primary">
<span class="material-symbols-outlined">inventory_2</span>
<span class="text-[10px] font-bold">STOCK</span>
</div>
</nav>
</div>
</div>
</div>
<!-- Pantalla 6: Confirmaci√≥n de Pedido -->
<div id="page-confirmation" class="page">
<div class="bg-background-light dark:bg-background-dark text-[#171212] dark:text-white min-h-screen flex items-center justify-center">
<div class="max-w-[480px] lg:max-w-[600px] mobile-container mx-auto px-6 py-12">
<!-- Success Icon -->
<div class="flex justify-center mb-8">
<div class="size-24 rounded-full bg-primary/10 dark:bg-primary/20 flex items-center justify-center">
<span class="material-symbols-outlined text-primary text-6xl">check_circle</span>
</div>
</div>
<!-- Success Message -->
<div class="text-center mb-8">
<h1 class="text-[#171212] dark:text-white text-3xl lg:text-4xl font-extrabold leading-tight mb-4">¬°Pedido Confirmado!</h1>
<p class="text-[#836967] dark:text-zinc-400 text-base lg:text-lg leading-relaxed mb-6">
Tu pedido ha sido enviado exitosamente por WhatsApp.<br>
Te contactaremos pronto para confirmar los detalles.
</p>
<!-- Order Info Card -->
<div class="bg-white dark:bg-zinc-900 rounded-2xl p-6 shadow-lg border border-gray-100 dark:border-zinc-800 mb-8">
<div class="flex items-center justify-center gap-3 mb-4">
<span class="material-symbols-outlined text-primary text-2xl">chat</span>
<span class="text-[#171212] dark:text-white text-lg font-bold">WhatsApp</span>
</div>
<p class="text-sm text-[#836967] dark:text-zinc-400 text-center">
Revisa tu conversaci√≥n de WhatsApp para ver los detalles de tu pedido.
</p>
</div>
<!-- Action Buttons -->
<div class="space-y-4">
<button onclick="router.navigate('home')" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 px-6 rounded-xl shadow-lg shadow-primary/25 hover:shadow-xl hover:shadow-primary/30 flex items-center justify-center gap-3 transition-all active:scale-[0.98] text-base">
<span class="material-symbols-outlined">home</span>
<span>Volver al Inicio</span>
</button>
<button onclick="router.navigate('menu')" class="w-full bg-white dark:bg-zinc-900 hover:bg-gray-50 dark:hover:bg-zinc-800 text-[#171212] dark:text-white font-bold py-4 px-6 rounded-xl border-2 border-gray-200 dark:border-zinc-700 flex items-center justify-center gap-3 transition-all active:scale-[0.98] text-base">
<span class="material-symbols-outlined">restaurant_menu</span>
<span>Ver M√°s Productos</span>
</button>
</div>
</div>
</div>
</div>
</div>
<!-- Pantalla 3: Product Detail -->
<div id="page-product" class="page">
<div class="relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark overflow-x-hidden pb-32 lg:pb-8 max-w-[430px] lg:max-w-[900px] mobile-container mx-auto shadow-2xl">
<!-- Top App Bar (Overlaid on Image) -->
<div class="fixed lg:sticky top-0 z-50 flex w-full items-center justify-between p-4 bg-gradient-to-b from-black/40 lg:from-background-light/80 lg:dark:from-background-dark/80 to-transparent lg:to-transparent lg:backdrop-blur-md max-w-[430px] lg:max-w-[900px] fixed-top-desktop">
<button onclick="router.navigate('menu')" class="flex size-10 items-center justify-center rounded-full bg-white/20 backdrop-blur-md text-white">
<span class="material-symbols-outlined">arrow_back_ios_new</span>
</button>
<div class="flex gap-2">
<button class="flex size-10 items-center justify-center rounded-full bg-white/20 backdrop-blur-md text-white">
<span class="material-symbols-outlined">favorite</span>
</button>
<button class="flex size-10 items-center justify-center rounded-full bg-white/20 backdrop-blur-md text-white">
<span class="material-symbols-outlined">share</span>
</button>
</div>
</div>
<!-- Header Image Section -->
<div class="@container w-full">
<div class="relative w-full h-[45vh] min-h-80 overflow-hidden bg-white" id="productImageContainer">
<div class="absolute inset-0 bg-center bg-no-repeat bg-cover" id="productImage" style="background-image: url(''); background-color: #b5352c;">
</div>
</div>
</div>
<!-- Product Details -->
<div class="px-5 pt-8" id="productDetailsContainer">
<div class="flex items-center justify-between">
<span id="productBadge" class="px-2.5 py-1 rounded-full bg-green-100 text-green-700 text-xs font-bold uppercase tracking-wider hidden"></span>
<div class="flex items-center gap-1 text-primary">
<span class="material-symbols-outlined !text-lg">star_rate</span>
<span class="text-sm font-bold">4.9</span>
</div>
</div>
<!-- Headline -->
<h1 id="productName" class="text-[#171212] dark:text-white tracking-tight text-3xl font-extrabold leading-tight pt-3">Cargando...</h1>
<!-- Price -->
<h2 id="productPrice" class="text-primary text-2xl font-bold leading-tight pt-2">$0</h2>
<!-- Body Description -->
<p id="productDescription" class="text-[#171212]/70 dark:text-white/70 text-base font-normal leading-relaxed pt-4">
                Cargando descripci√≥n...
            </p>
</div>
<div class="h-4"></div>
<!-- Customization Modules -->
<div class="px-5 lg:px-8 space-y-6 form-section" id="productIngredientsContainer">
<!-- Ingredientes se cargar√°n din√°micamente -->
</div>
<!-- Safe area spacer for modern iOS -->
<div class="h-8"></div>
</div>
</div>

<!-- Router JavaScript -->
<script>
// Sistema de routing simple
const router = {
  currentPage: 'home',
  
  init() {
    // Navegar a la p√°gina inicial basada en el hash o por defecto 'home'
    const hash = window.location.hash.slice(1) || 'home';
    this.navigate(hash);
    
    // Escuchar cambios en el hash
    window.addEventListener('hashchange', () => {
      const hash = window.location.hash.slice(1) || 'home';
      this.navigate(hash);
    });
  },
  
  navigate(pageName) {
    // Redirigir 'profile' a 'orders' ya que no hay pantalla de perfil
    if (pageName === 'profile') {
      pageName = 'orders';
    }
    
    // Verificar autenticaci√≥n para el panel de admin
    if (pageName === 'admin') {
      const isAdminAuthenticated = sessionStorage.getItem('adminAuthenticated') === 'true';
      if (!isAdminAuthenticated) {
        // Redirigir al login de admin
        pageName = 'admin-login';
      }
    }
    
    // Ocultar todas las p√°ginas
    document.querySelectorAll('.page').forEach(page => {
      page.classList.remove('active');
    });
    
    // Mostrar la p√°gina solicitada
    const targetPage = document.getElementById(`page-${pageName}`);
    if (targetPage) {
      targetPage.classList.add('active');
      this.currentPage = pageName;
      window.location.hash = pageName;
      
      // Actualizar la barra de navegaci√≥n
      this.updateNavigation(pageName);
      
      // Inicializar precio del producto si estamos en la p√°gina de producto
      if (pageName === 'product') {
        // Resetear selecciones cuando se navega a la p√°gina del producto
        selectedSauces = ['mayonesa'];
        selectedExtras = [];
        // Cargar producto seleccionado
        setTimeout(() => {
          loadProductDetails();
        }, 100);
      }
      
      // Actualizar badges del carrito al navegar a cualquier p√°gina
      setTimeout(() => {
        updateCartBadges();
      }, 100);
      
      // Si estamos navegando al checkout, actualizar totales y salsas
      if (pageName === 'checkout') {
        setTimeout(() => {
          updateCheckoutTotal(document.getElementById('deliveryAddressSection') && !document.getElementById('deliveryAddressSection').classList.contains('hidden'));
          updateCheckoutSauces();
        }, 100);
      }
      
      // Si estamos navegando al panel admin, generar la lista de inventario
      if (pageName === 'admin') {
        setTimeout(() => {
          generateAdminInventory();
        }, 100);
      }
      
      // Si estamos navegando al men√∫, cargar productos si no est√°n cargados
      if (pageName === 'menu') {
        setTimeout(() => {
          const container = document.getElementById('menuProductsContainer');
          if (container && (container.children.length === 0 || container.innerHTML.trim() === '')) {
            loadProductsFromFirebase((products) => {
              generateCategoryFilters(products);
              generateMenuHTML(products);
            });
          }
          updateMenuStockStatus();
        }, 200);
      }
      
      // Si estamos navegando al home, actualizar categor√≠as y productos destacados
      if (pageName === 'home') {
        setTimeout(() => {
          loadProductsFromFirebase((products) => {
            generateHomeCategories(products);
            generateChefChoice(products);
            updatePromoHeroSlide(products);
          });
        }, 200);
      }
    } else {
      console.warn(`P√°gina "${pageName}" no encontrada`);
    }
  },
  
  updateNavigation(activePage) {
    // Actualizar los botones de la barra de navegaci√≥n inferior en todas las p√°ginas
    document.querySelectorAll('[onclick^="router.navigate"]').forEach(btn => {
      const isActive = btn.getAttribute('onclick').includes(`'${activePage}'`);
      const iconSpan = btn.querySelector('span.material-symbols-outlined');
      const textSpan = btn.querySelector('span:last-child') || btn.querySelector('p');
      
      if (isActive) {
        btn.classList.remove('text-gray-400', 'dark:text-gray-500', 'text-zinc-400');
        btn.classList.add('text-primary');
        if (iconSpan) {
          iconSpan.classList.add('font-variation-fill-1', 'font-fill');
        }
        if (textSpan) {
          textSpan.classList.remove('font-medium');
          textSpan.classList.add('font-bold');
        }
      } else {
        btn.classList.remove('text-primary');
        if (!btn.classList.contains('text-gray-400') && !btn.classList.contains('text-zinc-400')) {
          btn.classList.add('text-gray-400', 'dark:text-gray-500', 'text-zinc-400');
        }
        if (iconSpan) {
          iconSpan.classList.remove('font-variation-fill-1', 'font-fill');
        }
        if (textSpan) {
          textSpan.classList.remove('font-bold');
          if (textSpan.tagName === 'SPAN') {
            textSpan.classList.add('font-medium');
          }
        }
      }
    });
  }
};

// Variables globales para el producto actual
let selectedSauces = ['mayonesa']; // Mayonesa seleccionada por defecto
let selectedExtras = [];
const baseProductPrice = 18.50;

// Funci√≥n para alternar selecci√≥n de salsa (m√°ximo 2)
function toggleSauce(element, sauceName, price) {
  const isSelected = element.classList.contains('selected');
  const selectedCount = document.querySelectorAll('.sauce-option.selected').length;
  
  if (isSelected) {
    // Deseleccionar
    element.classList.remove('selected', 'border-primary', 'bg-primary/5');
    element.classList.add('border-[#171212]/10', 'dark:border-white/10', 'bg-white', 'dark:bg-white/5');
    const checkIcon = element.querySelector('.sauce-check');
    checkIcon.classList.remove('bg-primary');
    checkIcon.classList.add('border-2', 'border-primary/20');
    const icon = checkIcon.querySelector('span.material-symbols-outlined');
    icon.classList.add('opacity-0');
    icon.classList.remove('text-white');
    icon.classList.add('text-primary');
    
    selectedSauces = selectedSauces.filter(s => s !== sauceName);
  } else {
    // Verificar l√≠mite de 2 salsas
    if (selectedCount >= 2) {
      alert('Solo puedes seleccionar hasta 2 salsas');
      return;
    }
    
    // Seleccionar
    element.classList.add('selected', 'border-primary', 'bg-primary/5');
    element.classList.remove('border-[#171212]/10', 'dark:border-white/10');
    const checkIcon = element.querySelector('.sauce-check');
    checkIcon.classList.add('bg-primary');
    checkIcon.classList.remove('border-2', 'border-primary/20');
    const icon = checkIcon.querySelector('span.material-symbols-outlined');
    icon.classList.remove('opacity-0');
    icon.classList.add('text-white');
    icon.classList.remove('text-primary');
    
    selectedSauces.push(sauceName);
  }
  
  updateProductPrice();
}

// Funci√≥n para alternar selecci√≥n de extra
function toggleExtra(element, extraName, price) {
  const isSelected = element.classList.contains('selected');
  
  if (isSelected) {
    // Deseleccionar
    element.classList.remove('selected', 'border-primary', 'border-2', 'bg-primary/5');
    element.classList.add('border-[#171212]/10', 'dark:border-white/10', 'border');
    
    selectedExtras = selectedExtras.filter(e => e.name !== extraName);
  } else {
    // Seleccionar
    element.classList.add('selected', 'border-primary', 'border-2', 'bg-primary/5');
    element.classList.remove('border-[#171212]/10', 'dark:border-white/10');
    
    selectedExtras.push({ name: extraName, price: price });
  }
  
  updateProductPrice();
}

// Funci√≥n para actualizar el precio total del producto
function updateProductPrice() {
  let totalPrice = baseProductPrice;
  
  // Sumar precios de salsas seleccionadas
  document.querySelectorAll('.sauce-option.selected').forEach(option => {
    const price = parseFloat(option.dataset.price) || 0;
    totalPrice += price;
  });
  
  // Sumar precios de extras seleccionados
  selectedExtras.forEach(extra => {
    totalPrice += extra.price;
  });
  
  // Obtener cantidad
  const quantity = parseInt(document.getElementById('productQuantity')?.textContent || '1');
  const finalPrice = totalPrice * quantity;
  
  // Actualizar bot√≥n
  const priceSpan = document.getElementById('addToCartPrice');
  if (priceSpan) {
    priceSpan.textContent = `Agregar al Carrito - $${finalPrice.toFixed(2)}`;
  }
}

// Funci√≥n para actualizar cantidad del producto
function updateProductQuantity(change) {
  const quantityEl = document.getElementById('productQuantity');
  if (!quantityEl) return;
  
  let currentQty = parseInt(quantityEl.textContent) || 1;
  currentQty += change;
  
  if (currentQty < 1) currentQty = 1;
  
  quantityEl.textContent = currentQty;
  updateProductPrice();
}

// Funci√≥n para agregar producto directamente al carrito desde el men√∫ (sin personalizaciones)
// Variable global para rastrear botones que est√°n siendo procesados
const processingButtons = new Set();

function addToCartDirect(button, event) {
  // Prevenir propagaci√≥n SIEMPRE, incluso si event es undefined
  if (event) {
    event.preventDefault();
    event.stopPropagation();
    event.stopImmediatePropagation();
  }
  
  // Crear un ID √∫nico para este bot√≥n basado en su posici√≥n en el DOM
  const buttonId = button.outerHTML.length + Date.now();
  
  // Verificar si el bot√≥n est√° deshabilitado o ya est√° proces√°ndose
  if (button.disabled || processingButtons.has(buttonId)) {
    return false;
  }
  
  // Marcar el bot√≥n como procesando INMEDIATAMENTE
  processingButtons.add(buttonId);
  button.dataset.processing = 'true';
  
  // Obtener el contenedor del item (el div padre que contiene nombre y precio)
  const itemContainer = button.closest('.flex.flex-col.gap-2, .flex.flex-col.group');
  if (!itemContainer) {
    delete button.dataset.processing;
    return;
  }
  
  // Obtener nombre y precio del producto
  const nameEl = itemContainer.querySelector('h3');
  const priceEl = itemContainer.querySelector('p.text-\\[\\#836967\\].dark\\:text-zinc-400');
  
  if (!nameEl || !priceEl) {
    delete button.dataset.processing;
    return;
  }
  
  const productName = nameEl.textContent.trim();
  const priceText = priceEl.textContent.trim().replace('$', '').replace(',', '');
  const price = parseFloat(priceText) || 0;
  
  if (!productName || price === 0) {
    delete button.dataset.processing;
    return;
  }
  
  // Verificar stock antes de agregar
  getItemStockStatus(productName, (isInStock) => {
    // Funci√≥n de limpieza
    const cleanup = () => {
      setTimeout(() => {
        delete button.dataset.processing;
        processingButtons.delete(buttonId);
      }, 500);
    };
    
    if (!isInStock) {
      alert('Este producto est√° actualmente agotado');
      cleanup();
      return;
    }
    
    // Continuar con la l√≥gica de agregar al carrito
    addProductToCartInternal(productName, price);
    
    // Limpiar el flag despu√©s de un breve delay
    cleanup();
  });
  
  // Retornar false para prevenir acciones por defecto
  return false;
}

// Variable para prevenir doble agregado en la misma llamada
let isAddingToCart = false;

// Funci√≥n interna para agregar producto al carrito (separada para reutilizaci√≥n)
function addProductToCartInternal(productName, price) {
  // Prevenir doble ejecuci√≥n simult√°nea
  if (isAddingToCart) {
    console.log('Ya se est√° agregando un producto al carrito, ignorando duplicado');
    return;
  }
  
  // Marcar que estamos agregando
  isAddingToCart = true;
  
  // Obtener el contenedor del carrito
  const cartContainer = document.querySelector('#page-orders main .flex.flex-col.gap-4');
  if (!cartContainer) {
    isAddingToCart = false;
    return;
  }
  
  // Verificar si el producto ya est√° en el carrito antes de agregar (evitar duplicados)
  const existingItems = cartContainer.querySelectorAll('.bg-white.dark\\:bg-zinc-900');
  for (let item of existingItems) {
    const nameEl = item.querySelector('p.text-base.font-bold');
    if (nameEl && nameEl.textContent.trim() === productName) {
      // El producto ya existe en el carrito, solo incrementar cantidad
      const quantityInput = item.querySelector('input[type="number"]');
      if (quantityInput) {
        const currentQuantity = parseInt(quantityInput.value) || 1;
        quantityInput.value = currentQuantity + 1;
        updateCartTotals();
        updateCartBadges();
        isAddingToCart = false;
        return; // Salir sin agregar duplicado
      }
    }
  }
  
  // Buscar el producto en Firebase para obtener su imagen
  loadProductsFromFirebase((products) => {
    const product = products.find(p => p.name === productName);
    let productImage = '';
    
    if (product && product.imageUrl) {
      const imageUrlRaw = product.imageUrl || '';
      const hasImage = imageUrlRaw.trim() !== '' && (
        imageUrlRaw.startsWith('http://') || 
        imageUrlRaw.startsWith('https://') || 
        imageUrlRaw.startsWith('data:image')
      );
      if (hasImage) {
        productImage = imageUrlRaw;
      } else {
        productImage = getPlaceholderImage(productName, product.category || '');
      }
    } else {
      productImage = getPlaceholderImage(productName, '');
    }
    
    // Crear el elemento del carrito
    const cartItem = document.createElement('div');
    cartItem.className = 'flex items-center gap-4 bg-white dark:bg-zinc-900 p-3 rounded-xl shadow-sm border border-gray-50 dark:border-zinc-800 justify-between';
    cartItem.innerHTML = `
    <div class="flex items-center gap-4">
      <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-20 shadow-inner bg-gray-200 dark:bg-zinc-800" style="background-image: url('${productImage}'); background-color: #b5352c;"></div>
      <div class="flex flex-col justify-center flex-1">
        <p class="text-[#171212] dark:text-white text-base font-bold leading-tight line-clamp-1">${productName}</p>
        <p class="text-[#836967] dark:text-zinc-400 text-sm font-medium mt-1">$${price.toFixed(2)}</p>
        <!-- Selector de Salsa Principal para este producto -->
        <select class="product-main-sauce mt-2 w-full rounded-lg border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-background-dark text-[#171212] dark:text-white h-9 px-3 text-xs focus:outline-0 focus:ring-2 focus:ring-primary/50 appearance-none cursor-pointer" style="background-image: url('data:image/svg+xml;charset=UTF-8,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2712%27 height=%2712%27 viewBox=%270 0 12 12%27%3E%3Cpath fill=%27%23333%27 d=%27M6 9L1 4h10L6 9z%27/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 10px; padding-right: 2rem;">
          <option value="">Sin salsa</option>
          <option value="soya">Salsa Soya</option>
          <option value="agridulce">Salsa Agridulce</option>
        </select>
      </div>
    </div>
    <div class="shrink-0 flex items-center gap-3">
      <div class="flex flex-col items-center gap-2 text-[#171212] dark:text-white">
        <button onclick="cartFunctions.incrementQuantity(this, event); return false;" class="text-white flex h-7 w-7 items-center justify-center rounded-lg bg-primary cursor-pointer shadow-sm shadow-primary/30">
          <span class="material-symbols-outlined text-sm">add</span>
        </button>
        <input class="text-base font-bold w-6 p-0 text-center bg-transparent focus:outline-0 focus:ring-0 focus:border-none border-none [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none text-[#171212] dark:text-white" type="number" value="1"/>
        <button onclick="cartFunctions.decrementQuantity(this, event); return false;" class="text-[#171212] dark:text-white flex h-7 w-7 items-center justify-center rounded-lg bg-[#f4f1f1] dark:bg-zinc-800 cursor-pointer">
          <span class="material-symbols-outlined text-sm">remove</span>
        </button>
      </div>
      <button onclick="cartFunctions.removeItem(this)" class="flex h-8 w-8 items-center justify-center rounded-lg bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors cursor-pointer" title="Eliminar del carrito">
        <span class="material-symbols-outlined text-sm">delete</span>
      </button>
    </div>
  `;
  
  // Insertar antes de la tarjeta de sugerencia si existe, o al final
  const suggestionCard = cartContainer.querySelector('.border-dashed');
  if (suggestionCard) {
    cartContainer.insertBefore(cartItem, suggestionCard);
  } else {
    cartContainer.appendChild(cartItem);
  }
  
  // Actualizar totales del carrito
  updateCartTotals();
  
  // Actualizar badges
  updateCartBadges();
  
    // Liberar el flag DESPU√âS de completar la inserci√≥n
    isAddingToCart = false;
    
    // Navegar autom√°ticamente al carrito
    router.navigate('orders');
  });
}

// Funci√≥n para actualizar los totales del carrito en el footer
function updateCartTotals() {
  const cartItems = getCartItems();
  let subtotal = 0;
  
  cartItems.forEach(item => {
    subtotal += item.subtotal;
  });
  
  // Agregar costo de salsas adicionales
  const soyaQty = parseInt(document.getElementById('extraSauceSoyaQty')?.value || '0');
  const agridulceQty = parseInt(document.getElementById('extraSauceAgridulceQty')?.value || '0');
  const extraSaucePrice = 500; // Precio por unidad de salsa adicional
  const extraSaucesTotal = (soyaQty + agridulceQty) * extraSaucePrice;
  subtotal += extraSaucesTotal;
  
  const shipping = subtotal >= extraSaucesTotal && subtotal - extraSaucesTotal > 0 ? 5.00 : 0.00; // Env√≠o gratuito si hay items
  const total = subtotal + shipping;
  
  // Actualizar en el DOM
  const subtotalEl = document.querySelector('#page-orders footer .space-y-3 .flex.justify-between.items-center:first-child p.text-right');
  const shippingEl = document.querySelector('#page-orders footer .space-y-3 .flex.justify-between.items-center:nth-child(2) p.text-right');
  const totalEl = document.querySelector('#page-orders footer p.text-primary.text-2xl');
  
  if (subtotalEl) {
    subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
  }
  if (shippingEl) {
    shippingEl.textContent = subtotal > extraSaucesTotal ? `$${shipping.toFixed(2)}` : '$0.00';
  }
  if (totalEl) {
    totalEl.textContent = `$${total.toFixed(2)}`;
  }
  
  // Actualizar total en checkout si est√° visible
  const checkoutTotalEl = document.getElementById('checkoutTotal');
  if (checkoutTotalEl) {
    updateCheckoutTotal(document.getElementById('deliveryAddressSection') && !document.getElementById('deliveryAddressSection').classList.contains('hidden'));
  }
  
  // Actualizar visualizaci√≥n de salsas en checkout
  updateCheckoutSauces();
}

// Funci√≥n para agregar producto al carrito (con personalizaciones desde p√°gina de producto)
function addProductToCart() {
  const productName = document.querySelector('#page-product h1')?.textContent.trim() || 'El Burger Katsu Rey';
  const quantity = parseInt(document.getElementById('productQuantity')?.textContent || '1');
  
  // Calcular precio total
  let totalPrice = baseProductPrice;
  const saucesList = [];
  
  document.querySelectorAll('.sauce-option.selected').forEach(option => {
    const sauceName = option.querySelector('p.font-bold')?.textContent.trim() || '';
    const price = parseFloat(option.dataset.price) || 0;
    totalPrice += price;
    if (sauceName) saucesList.push(sauceName);
  });
  
  const extrasList = [];
  selectedExtras.forEach(extra => {
    totalPrice += extra.price;
    extrasList.push(extra.name);
  });
  
  const finalPrice = totalPrice * quantity;
  
  // Obtener instrucciones especiales
  const instructions = document.getElementById('specialInstructions')?.value.trim() || '';
  
  // Crear resumen de personalizaciones
  let customizationText = '';
  if (saucesList.length > 0) {
    customizationText += saucesList.join(', ');
  }
  if (extrasList.length > 0) {
    if (customizationText) customizationText += ' | ';
    customizationText += extrasList.map(e => {
      const names = { 'aguacate': 'Aguacate Extra', 'tempura': 'Hojuelas Tempura', 'jengibre': 'Jengibre Fresco' };
      return names[e] || e;
    }).join(', ');
  }
  if (instructions) {
    if (customizationText) customizationText += ' | ';
    customizationText += `Instrucciones: ${instructions}`;
  }
  
  // Almacenar las personalizaciones en sessionStorage para que est√©n disponibles cuando se genere el mensaje de WhatsApp
  // Las personalizaciones se asociar√°n con el nombre del producto
  const customizationData = {
    sauces: saucesList,
    extras: extrasList.map(e => e.name),
    instructions: instructions
  };
  
  // Guardar en sessionStorage con una clave √∫nica basada en timestamp
  const cartItemId = `cart_item_${Date.now()}`;
  sessionStorage.setItem(cartItemId, JSON.stringify({
    productName: productName,
    quantity: quantity,
    price: finalPrice / quantity, // Precio unitario
    customizations: customizationData,
    customizationText: customizationText,
    timestamp: Date.now() // Agregar timestamp para ordenar
  }));
  
  // Por ahora, navegar al carrito (el mensaje de WhatsApp incluir√° toda esta info)
  // NOTA: En una implementaci√≥n completa, aqu√≠ agregar√≠as el item al DOM del carrito con data-customizations
  
  // Navegar al carrito directamente
  router.navigate('orders');
}

// Funci√≥n para contar el total de items en el carrito
function getCartItemCount() {
  const cartContainer = document.querySelector('#page-orders main .flex.flex-col.gap-4');
  if (!cartContainer) return 0;
  
  // Buscar solo items del carrito que tengan selector de salsa principal (excluyendo salsas adicionales)
  // Los items del carrito tienen .product-main-sauce, las salsas adicionales NO
  const sauceSelectors = cartContainer.querySelectorAll('.product-main-sauce');
  let totalCount = 0;
  
  sauceSelectors.forEach(sauceSelector => {
    // Encontrar el contenedor del item del carrito (el div padre con bg-white)
    const cartItem = sauceSelector.closest('.bg-white.dark\\:bg-zinc-900');
    if (cartItem) {
      // Buscar el input de cantidad dentro de este item
      const quantityInput = cartItem.querySelector('input[type="number"]');
      if (quantityInput) {
        const quantity = parseInt(quantityInput.value) || 1;
        totalCount += quantity;
      }
    }
  });
  
  return totalCount;
}

// Funci√≥n para actualizar los badges del carrito
function updateCartBadges() {
  const itemCount = getCartItemCount();
  const badgeHome = document.getElementById('cartBadgeHome');
  const badgeMenu = document.getElementById('cartBadgeMenu');
  
  // Actualizar badge en home
  if (badgeHome) {
    if (itemCount > 0) {
      badgeHome.textContent = itemCount;
      badgeHome.classList.remove('hidden');
    } else {
      badgeHome.classList.add('hidden');
    }
  }
  
  // Actualizar badge en menu
  if (badgeMenu) {
    if (itemCount > 0) {
      badgeMenu.textContent = itemCount;
      badgeMenu.classList.remove('hidden');
    } else {
      badgeMenu.classList.add('hidden');
    }
  }
}

// Funci√≥n para obtener los items del carrito desde el DOM
function getCartItems() {
  const cartItems = [];
  const cartContainer = document.querySelector('#page-orders main .flex.flex-col.gap-4');
  
  if (!cartContainer) return cartItems;
  
  const itemElements = cartContainer.querySelectorAll('.bg-white.dark\\:bg-zinc-900');
  
  // Obtener todas las personalizaciones almacenadas en sessionStorage
  const storedCustomizations = [];
  for (let i = 0; i < sessionStorage.length; i++) {
    const key = sessionStorage.key(i);
    if (key && key.startsWith('cart_item_')) {
      try {
        const storedItem = JSON.parse(sessionStorage.getItem(key));
        storedCustomizations.push(storedItem);
      } catch (e) {
        console.error('Error parsing stored item:', e);
      }
    }
  }
  
  itemElements.forEach(itemEl => {
    const nameEl = itemEl.querySelector('p.text-base.font-bold');
    const priceEl = itemEl.querySelector('p.text-\\[\\#836967\\].dark\\:text-zinc-400.text-sm');
    const quantityInput = itemEl.querySelector('input[type="number"]');
    const extrasEl = itemEl.querySelector('p.text-\\[10px\\].text-zinc-400');
    
    // Buscar informaci√≥n de personalizaci√≥n almacenada en data attributes
    const customizations = itemEl.dataset.customizations ? JSON.parse(itemEl.dataset.customizations) : null;
    
    if (nameEl && priceEl && quantityInput) {
      const name = nameEl.textContent.trim();
      const priceText = priceEl.textContent.trim().replace('$', '').replace(',', '');
      const price = parseFloat(priceText) || 0;
      const quantity = parseInt(quantityInput.value) || 1;
      const extras = extrasEl ? extrasEl.textContent.trim() : '';
      
      // Buscar personalizaciones almacenadas en sessionStorage que coincidan con este producto
      let storedCustomization = null;
      if (!customizations && storedCustomizations.length > 0) {
        // Buscar la personalizaci√≥n m√°s reciente que coincida con el nombre del producto
        storedCustomization = storedCustomizations
          .filter(item => item.productName === name)
          .sort((a, b) => b.timestamp - a.timestamp)[0];
      }
      
      // Usar customizations de data attribute, sessionStorage, o extras del DOM
      let finalCustomizations = customizations;
      if (!finalCustomizations && storedCustomization && storedCustomization.customizations) {
        finalCustomizations = storedCustomization.customizations;
      }
      
      // Construir informaci√≥n de personalizaci√≥n completa
      let customizationText = '';
      if (finalCustomizations) {
        const parts = [];
        
        // Agregar salsas seleccionadas
        if (finalCustomizations.sauces && finalCustomizations.sauces.length > 0) {
          parts.push(`Salsas: ${finalCustomizations.sauces.join(', ')}`);
        }
        
        // Agregar extras seleccionados
        if (finalCustomizations.extras && finalCustomizations.extras.length > 0) {
          const extraNames = finalCustomizations.extras.map(e => {
            const names = { 'aguacate': 'Aguacate Extra', 'tempura': 'Hojuelas Tempura', 'jengibre': 'Jengibre Fresco' };
            return names[e] || e;
          });
          parts.push(`Extras: ${extraNames.join(', ')}`);
        }
        
        // Agregar instrucciones especiales
        if (finalCustomizations.instructions && finalCustomizations.instructions.trim()) {
          parts.push(`Instrucciones: ${finalCustomizations.instructions}`);
        }
        
        customizationText = parts.join(' | ');
      } else if (extras) {
        // Si no hay customizations detalladas, usar el texto de extras existente
        customizationText = extras;
      }
      
      cartItems.push({
        name: name,
        price: price,
        quantity: quantity,
        extras: customizationText || extras,
        subtotal: price * quantity,
        customizations: finalCustomizations || null
      });
    }
  });
  
  return cartItems;
}

// Funci√≥n para obtener los totales del carrito
function getCartTotals() {
  const subtotalEl = document.querySelector('#page-orders footer .space-y-3 .flex.justify-between.items-center:first-child p.text-right');
  const shippingEl = document.querySelector('#page-orders footer .space-y-3 .flex.justify-between.items-center:nth-child(2) p.text-right');
  const totalEl = document.querySelector('#page-orders footer p.text-primary.text-2xl');
  
  let subtotal = 0.00;
  let shipping = 0.00;
  let total = 0.00;
  
  if (subtotalEl) {
    const subtotalText = subtotalEl.textContent.trim().replace('$', '').replace(',', '');
    subtotal = parseFloat(subtotalText) || subtotal;
  }
  
  if (shippingEl) {
    const shippingText = shippingEl.textContent.trim().replace('$', '').replace(',', '');
    shipping = parseFloat(shippingText) || shipping;
  }
  
  if (totalEl) {
    const totalText = totalEl.textContent.trim().replace('$', '').replace(',', '');
    total = parseFloat(totalText) || total;
  }
  
  return { subtotal, shipping, total };
}

// Funci√≥n para limpiar el carrito
function clearCart() {
  // Limpiar items del carrito eliminando todos los elementos excepto el banner y la sugerencia
  const cartContainer = document.querySelector('#page-orders main .flex.flex-col.gap-4');
  if (cartContainer) {
    // Eliminar todos los items del carrito (elementos con bg-white dark:bg-zinc-900)
    const cartItems = cartContainer.querySelectorAll('.bg-white.dark\\:bg-zinc-900');
    cartItems.forEach(item => {
      item.remove();
    });
  }
  
  // Limpiar personalizaciones almacenadas en sessionStorage
  const keysToRemove = [];
  for (let i = 0; i < sessionStorage.length; i++) {
    const key = sessionStorage.key(i);
    if (key && key.startsWith('cart_item_')) {
      keysToRemove.push(key);
    }
  }
  keysToRemove.forEach(key => {
    sessionStorage.removeItem(key);
  });
  
  // Actualizar los totales a cero
  const subtotalEl = document.querySelector('#page-orders footer .space-y-3 .flex.justify-between.items-center:first-child p.text-right');
  const shippingEl = document.querySelector('#page-orders footer .space-y-3 .flex.justify-between.items-center:nth-child(2) p.text-right');
  const totalEl = document.querySelector('#page-orders footer p.text-primary.text-2xl');
  
  if (subtotalEl) {
    subtotalEl.textContent = '$0.00';
  }
  if (shippingEl) {
    shippingEl.textContent = '$0.00';
  }
  if (totalEl) {
    totalEl.textContent = '$0.00';
  }
  
  // Actualizar badges del carrito
  updateCartBadges();
}

// Funci√≥n para actualizar cantidad de salsa adicional
function updateExtraSauceQuantity(sauceType, change, event) {
  if (event) {
    event.preventDefault();
    event.stopPropagation();
  }
  
  // Mapear el tipo de salsa al ID correcto
  const sauceIds = {
    'soya': 'extraSauceSoyaQty',
    'agridulce': 'extraSauceAgridulceQty'
  };
  const inputId = sauceIds[sauceType];
  
  if (!inputId) {
    console.error('Tipo de salsa no v√°lido:', sauceType);
    return;
  }
  
  const input = document.getElementById(inputId);
  
  if (input) {
    let currentValue = parseInt(input.value) || 0;
    currentValue += change;
    
    if (currentValue < 0) currentValue = 0;
    
    input.value = currentValue;
    
    // Actualizar totales del carrito cuando cambia la cantidad de salsa
    updateCartTotals();
  }
}

// Funci√≥n para obtener las salsas seleccionadas del carrito
function getCartSauces() {
  // Obtener salsas principales de cada producto del carrito
  const productMainSauces = [];
  const cartItems = document.querySelectorAll('#page-orders .bg-white.dark\\:bg-zinc-900');
  
  cartItems.forEach((itemEl, index) => {
    const productNameEl = itemEl.querySelector('p.text-base.font-bold');
    const sauceSelect = itemEl.querySelector('.product-main-sauce');
    
    if (productNameEl && sauceSelect && sauceSelect.value) {
      productMainSauces.push({
        productIndex: index + 1,
        productName: productNameEl.textContent.trim(),
        sauce: sauceSelect.value
      });
    }
  });
  
  // Obtener cantidades de salsas adicionales
  const extraSauces = [];
  const soyaQty = parseInt(document.getElementById('extraSauceSoyaQty')?.value || '0');
  const agridulceQty = parseInt(document.getElementById('extraSauceAgridulceQty')?.value || '0');
  
  if (soyaQty > 0) {
    extraSauces.push({
      type: 'soya',
      quantity: soyaQty,
      price: 500
    });
  }
  
  if (agridulceQty > 0) {
    extraSauces.push({
      type: 'agridulce',
      quantity: agridulceQty,
      price: 500
    });
  }
  
  return {
    productMainSauces: productMainSauces,
    extraSauces: extraSauces
  };
}

// Funci√≥n para obtener datos del checkout
function getCheckoutData() {
  const fullName = document.getElementById('fullName')?.value || '';
  const paymentMethod = document.getElementById('paymentMethod')?.value || 'efectivo';
  const btnRetiro = document.getElementById('btnRetiro');
  const deliveryType = btnRetiro && (btnRetiro.classList.contains('bg-white') || btnRetiro.classList.contains('dark:bg-surface-dark')) ? 'retiro' : 'despacho';
  const deliveryAddress = document.getElementById('deliveryAddress')?.value || '';
  const checkoutTotal = document.getElementById('checkoutTotal')?.textContent.trim().replace('$', '').replace(',', '') || '0.00';
  const sauces = getCartSauces();
  const observations = document.getElementById('customerObservations')?.value || '';
  
  return {
    fullName,
    paymentMethod,
    deliveryType,
    deliveryAddress,
    total: parseFloat(checkoutTotal) || 0.00,
    sauces: sauces,
    observations: observations
  };
}

// Funci√≥n para generar el mensaje de WhatsApp
function generateWhatsAppMessage() {
  const cartItems = getCartItems();
  const cartTotals = getCartTotals();
  const checkoutData = getCheckoutData();
  
  let message = '*üç£ NUEVO PEDIDO - SPEED ROLL üç£*\n\n';
  
  // Informaci√≥n del cliente
  message += '*üë§ CLIENTE:*\n';
  message += `${checkoutData.fullName || 'No especificado'}\n\n`;
  
  // Detalle del pedido
  message += '*üì¶ PEDIDO:*\n';
  if (cartItems.length === 0) {
    message += 'Carrito vac√≠o\n';
  } else {
    cartItems.forEach((item, index) => {
      message += `${index + 1}. ${item.name} x${item.quantity}\n`;
      
      // Mostrar personalizaciones detalladas
      if (item.customizations) {
        const customParts = [];
        
        // Salsas
        if (item.customizations.sauces && item.customizations.sauces.length > 0) {
          customParts.push(`   üßÇ Salsas: ${item.customizations.sauces.join(', ')}`);
        }
        
        // Extras
        if (item.customizations.extras && item.customizations.extras.length > 0) {
          const extraNames = item.customizations.extras.map(e => {
            const names = { 'aguacate': 'Aguacate Extra', 'tempura': 'Hojuelas Tempura', 'jengibre': 'Jengibre Fresco' };
            return names[e] || e;
          });
          customParts.push(`   ‚ûï Extras: ${extraNames.join(', ')}`);
        }
        
        // Instrucciones especiales
        if (item.customizations.instructions && item.customizations.instructions.trim()) {
          customParts.push(`   üìù Instrucciones: ${item.customizations.instructions}`);
        }
        
        if (customParts.length > 0) {
          message += customParts.join('\n') + '\n';
        }
      } else if (item.extras) {
        // Si no hay customizations detalladas, mostrar extras generales
        message += `   ‚ûú ${item.extras}\n`;
      }
      
      message += `   üí∞ $${item.price.toFixed(2)} c/u = $${item.subtotal.toFixed(2)}\n\n`;
    });
  }
  
  // Salsas principales por producto
  if (checkoutData.sauces && checkoutData.sauces.productMainSauces && checkoutData.sauces.productMainSauces.length > 0) {
    message += '\n*üßÇ SALSAS PRINCIPALES:*\n';
    const sauceNames = {
      'soya': 'Salsa Soya',
      'agridulce': 'Salsa Agridulce'
    };
    
    checkoutData.sauces.productMainSauces.forEach(item => {
      message += `${item.productName}: ${sauceNames[item.sauce] || item.sauce}\n`;
    });
  }
  
  // Salsas adicionales con cantidades
  if (checkoutData.sauces && checkoutData.sauces.extraSauces && checkoutData.sauces.extraSauces.length > 0) {
    message += '\n*üßÇ SALSAS ADICIONALES:*\n';
    const sauceNames = {
      'soya': 'Salsa Soya',
      'agridulce': 'Salsa Agridulce'
    };
    
    checkoutData.sauces.extraSauces.forEach(sauce => {
      const sauceName = sauceNames[sauce.type] || sauce.type;
      const totalPrice = sauce.quantity * sauce.price;
      message += `${sauceName} x${sauce.quantity} = $${totalPrice.toFixed(0)}\n`;
    });
  }
  
  // Observaciones del cliente
  if (checkoutData.observations && checkoutData.observations.trim()) {
    message += '\n*üìù OBSERVACIONES DEL CLIENTE:*\n';
    message += `${checkoutData.observations.trim()}\n`;
  }
  
  // Resumen de totales
  message += '\n*üí∞ RESUMEN:*\n';
  message += `Subtotal: $${cartTotals.subtotal.toFixed(2)}\n`;
  
  // Informaci√≥n de entrega
  message += '\n*üöö ENTREGA:*\n';
  if (checkoutData.deliveryType === 'despacho') {
    message += `Tipo: Despacho a domicilio\n`;
    if (checkoutData.deliveryAddress) {
      message += `Direcci√≥n: ${checkoutData.deliveryAddress}\n`;
    }
    message += `Costo de despacho: $3.000\n`;
  } else {
    message += `Tipo: Retiro en local\n`;
  }
  
  // Medio de pago
  message += '\n*üí≥ PAGO:*\n';
  const paymentMethods = {
    'efectivo': 'Efectivo',
    'tarjeta': 'Tarjeta',
    'transferencia': 'Transferencia'
  };
  message += `${paymentMethods[checkoutData.paymentMethod] || checkoutData.paymentMethod}\n`;
  
  // Total final
  message += `\n*‚úÖ TOTAL: $${checkoutData.total.toFixed(2)}*\n\n`;
  
  message += '_Gracias por tu pedido_ üéâ';
  
  return message;
}

// Funci√≥n para enviar mensaje por WhatsApp
function sendWhatsAppMessage(phoneNumber = null) {
  const message = generateWhatsAppMessage();
  const encodedMessage = encodeURIComponent(message);
  
  // Si no se proporciona n√∫mero, usar WhatsApp Web (el usuario elegir√° el contacto)
  // Para usar con n√∫mero espec√≠fico: sendWhatsAppMessage('+56912345678')
  const whatsappUrl = phoneNumber 
    ? `https://wa.me/${phoneNumber.replace(/[^0-9]/g, '')}?text=${encodedMessage}`
    : `https://web.whatsapp.com/send?text=${encodedMessage}`;
  
  window.open(whatsappUrl, '_blank');
}

// Funci√≥n para manejar el pago en checkout
function handlePayment() {
  // Validar que haya informaci√≥n m√≠nima
  const checkoutData = getCheckoutData();
  const cartItems = getCartItems();
  
  if (!checkoutData.fullName || checkoutData.fullName.trim() === '') {
    alert('Por favor, ingresa tu nombre completo');
    return;
  }
  
  if (cartItems.length === 0) {
    alert('Tu carrito est√° vac√≠o');
    return;
  }
  
  if (checkoutData.deliveryType === 'despacho' && (!checkoutData.deliveryAddress || checkoutData.deliveryAddress.trim() === '')) {
    alert('Por favor, ingresa la direcci√≥n de despacho');
    return;
  }
  
  // Generar y enviar mensaje de WhatsApp con el n√∫mero del negocio
  sendWhatsAppMessage('+56921922139');
  
  // Limpiar el carrito
  clearCart();
  
  // Limpiar formulario de checkout
  document.getElementById('fullName').value = '';
  document.getElementById('paymentMethod').value = 'efectivo';
  document.getElementById('deliveryAddress').value = '';
  document.getElementById('customerObservations').value = '';
  toggleDeliveryOption('retiro'); // Resetear a retiro
  
  // Limpiar salsas del carrito
  // Limpiar selectores de salsa principal en cada producto
  const productMainSauceSelects = document.querySelectorAll('.product-main-sauce');
  productMainSauceSelects.forEach(select => {
    select.value = '';
  });
  
  // Limpiar cantidades de salsas adicionales
  const extraSauceSoyaQty = document.getElementById('extraSauceSoyaQty');
  const extraSauceAgridulceQty = document.getElementById('extraSauceAgridulceQty');
  if (extraSauceSoyaQty) {
    extraSauceSoyaQty.value = '0';
  }
  if (extraSauceAgridulceQty) {
    extraSauceAgridulceQty.value = '0';
  }
  
  // Navegar a la p√°gina de confirmaci√≥n
  setTimeout(() => {
    router.navigate('confirmation');
  }, 500);
}

// Funci√≥n para alternar entre retiro y despacho
function toggleDeliveryOption(option) {
  const addressSection = document.getElementById('deliveryAddressSection');
  const btnRetiro = document.getElementById('btnRetiro');
  const btnDespacho = document.getElementById('btnDespacho');
  
  if (option === 'despacho') {
    addressSection.classList.remove('hidden');
    btnDespacho.classList.remove('text-gray-500', 'dark:text-gray-400');
    btnDespacho.classList.add('bg-white', 'dark:bg-surface-dark', 'shadow-sm', 'text-primary', 'font-bold');
    btnRetiro.classList.remove('bg-white', 'dark:bg-surface-dark', 'shadow-sm', 'text-primary', 'font-bold');
    btnRetiro.classList.add('text-gray-500', 'dark:text-gray-400', 'font-medium');
    updateCheckoutTotal(true);
  } else {
    addressSection.classList.add('hidden');
    btnRetiro.classList.remove('text-gray-500', 'dark:text-gray-400');
    btnRetiro.classList.add('bg-white', 'dark:bg-surface-dark', 'shadow-sm', 'text-primary', 'font-bold');
    btnDespacho.classList.remove('bg-white', 'dark:bg-surface-dark', 'shadow-sm', 'text-primary', 'font-bold');
    btnDespacho.classList.add('text-gray-500', 'dark:text-gray-400', 'font-medium');
    updateCheckoutTotal(false);
  }
}

// Funci√≥n para actualizar el total en checkout
function updateCheckoutTotal(hasDelivery) {
  // Calcular el total real del carrito
  const cartItems = getCartItems();
  let baseTotal = 0;
  cartItems.forEach(item => {
    baseTotal += item.subtotal;
  });
  
  // Agregar costo de salsas adicionales
  const soyaQty = parseInt(document.getElementById('extraSauceSoyaQty')?.value || '0');
  const agridulceQty = parseInt(document.getElementById('extraSauceAgridulceQty')?.value || '0');
  const extraSaucePrice = 500; // Precio por unidad de salsa adicional
  const extraSaucesTotal = (soyaQty + agridulceQty) * extraSaucePrice;
  baseTotal += extraSaucesTotal;
  
  const deliveryCost = 3000;
  const totalElement = document.getElementById('checkoutTotal');
  
  if (hasDelivery) {
    const newTotal = baseTotal + deliveryCost;
    if (totalElement) {
      totalElement.textContent = `$${newTotal.toLocaleString('es-CL', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
    }
  } else {
    if (totalElement) {
      totalElement.textContent = `$${baseTotal.toFixed(2)}`;
    }
  }
}

// Funci√≥n para actualizar la visualizaci√≥n de salsas en el checkout
function updateCheckoutSauces() {
  const checkoutSaucesContainer = document.getElementById('checkoutSaucesSection');
  if (!checkoutSaucesContainer) return;
  
  const sauces = getCartSauces();
  let html = '';
  
  // Mostrar salsas principales por producto
  if (sauces.productMainSauces && sauces.productMainSauces.length > 0) {
    html += '<div class="mb-3">';
    html += '<p class="text-xs font-medium text-[#836967] dark:text-zinc-400 mb-2">Salsas Principales:</p>';
    const sauceNames = {
      'soya': 'Salsa Soya',
      'agridulce': 'Salsa Agridulce'
    };
    sauces.productMainSauces.forEach(item => {
      html += `<div class="flex items-center justify-between text-sm mb-1">
        <span class="text-[#171212] dark:text-white">${item.productName}</span>
        <span class="text-[#836967] dark:text-zinc-400">${sauceNames[item.sauce] || item.sauce}</span>
      </div>`;
    });
    html += '</div>';
  }
  
  // Mostrar salsas adicionales con cantidades y precios
  if (sauces.extraSauces && sauces.extraSauces.length > 0) {
    html += '<div>';
    html += '<p class="text-xs font-medium text-[#836967] dark:text-zinc-400 mb-2">Salsas Adicionales:</p>';
    const sauceNames = {
      'soya': 'Salsa Soya',
      'agridulce': 'Salsa Agridulce'
    };
    sauces.extraSauces.forEach(sauce => {
      const sauceName = sauceNames[sauce.type] || sauce.type;
      const totalPrice = sauce.quantity * sauce.price;
      html += `<div class="flex items-center justify-between text-sm mb-1">
        <span class="text-[#171212] dark:text-white">${sauceName} x${sauce.quantity}</span>
        <span class="text-[#836967] dark:text-zinc-400 font-medium">$${totalPrice.toFixed(0)}</span>
      </div>`;
    });
    html += '</div>';
  }
  
  if (html === '') {
    checkoutSaucesContainer.innerHTML = '<p class="text-xs text-gray-400 dark:text-gray-500">No hay salsas seleccionadas</p>';
  } else {
    checkoutSaucesContainer.innerHTML = html;
  }
}

// Funcionalidades adicionales para botones
const cartFunctions = {
  // Incrementar cantidad
  incrementQuantity(button, event) {
    // Prevenir propagaci√≥n si el evento est√° presente
    if (event) {
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation(); // Prevenir que otros listeners manejen el evento
    }
    
    // Marcar el bot√≥n como manejado para prevenir doble ejecuci√≥n
    button.dataset.handled = 'true';
    
    const container = button.closest('.flex.flex-col.items-center');
    if (container) {
      const input = container.querySelector('input[type="number"]');
      if (input) {
        const currentValue = parseInt(input.value) || 1;
        input.value = currentValue + 1;
        
        // Actualizar badges del carrito
        updateCartBadges();
        
        // Actualizar totales del carrito y checkout
        updateCartTotals();
      }
    }
    
    // Remover el flag despu√©s de un breve delay para permitir futuros clicks
    setTimeout(() => {
      delete button.dataset.handled;
    }, 100);
    
    // Retornar false para prevenir propagaci√≥n adicional
    return false;
  },
  
  // Decrementar cantidad
  decrementQuantity(button, event) {
    // Prevenir propagaci√≥n si el evento est√° presente
    if (event) {
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation(); // Prevenir que otros listeners manejen el evento
    }
    
    // Marcar el bot√≥n como manejado para prevenir doble ejecuci√≥n
    button.dataset.handled = 'true';
    
    const container = button.closest('.flex.flex-col.items-center');
    if (container) {
      const input = container.querySelector('input[type="number"]');
      if (input) {
        const currentValue = parseInt(input.value) || 1;
        if (currentValue > 1) {
          input.value = currentValue - 1;
          
          // Actualizar badges del carrito
          updateCartBadges();
          
          // Actualizar totales del carrito y checkout
          updateCartTotals();
        }
      }
    }
    
    // Remover el flag despu√©s de un breve delay para permitir futuros clicks
    setTimeout(() => {
      delete button.dataset.handled;
    }, 100);
    
    // Retornar false para prevenir propagaci√≥n adicional
    return false;
  },
  
  // Eliminar item del carrito
  removeItem(button) {
    // Encontrar el contenedor del item completo (el div con bg-white dark:bg-zinc-900)
    const itemContainer = button.closest('.bg-white.dark\\:bg-zinc-900');
    if (itemContainer) {
      // Eliminar el item con animaci√≥n
      itemContainer.style.transition = 'opacity 0.3s, transform 0.3s';
      itemContainer.style.opacity = '0';
      itemContainer.style.transform = 'translateX(-20px)';
      
      setTimeout(() => {
        itemContainer.remove();
        // Actualizar badges del carrito
        updateCartBadges();
        // Actualizar totales del carrito y checkout
        updateCartTotals();
      }, 300);
    }
  }
};

// Inicializar el router cuando el DOM est√© listo
document.addEventListener('DOMContentLoaded', () => {
  router.init();
  
  // Inicializar badges del carrito
  updateCartBadges();
  
  // Esperar a que Firebase est√© listo y luego cargar productos
  const checkFirebaseAndInit = setInterval(() => {
    if (window.firebaseReady && window.firebaseDB) {
      clearInterval(checkFirebaseAndInit);
      
      // Cargar productos y generar men√∫
      loadProductsFromFirebase((products) => {
        generateCategoryFilters(products);
        generateMenuHTML(products);
        generateHomeCategories(products);
        generateChefChoice(products);
        updatePromoHeroSlide(products);
        
        // Configurar listener en tiempo real para productos
        listenToProductsChanges((products) => {
          generateCategoryFilters(products);
          generateMenuHTML(products);
          generateHomeCategories(products);
          generateChefChoice(products);
          updatePromoHeroSlide(products);
        });
      });
      
      // Si estamos en la p√°gina del men√∫, actualizar el estado de stock
      if (router.currentPage === 'menu') {
        setTimeout(() => {
          updateMenuStockStatus();
        }, 500);
      }
    }
  }, 100);
  
  // Timeout de seguridad despu√©s de 3 segundos
  setTimeout(() => {
    clearInterval(checkFirebaseAndInit);
    if (window.firebaseReady && window.firebaseDB) {
      loadProductsFromFirebase((products) => {
        if (products.length > 0) {
          generateCategoryFilters(products);
          generateMenuHTML(products);
          generateHomeCategories(products);
          generateChefChoice(products);
          updatePromoHeroSlide(products);
          if (router.currentPage === 'menu') {
            updateMenuStockStatus();
          }
        }
      });
    }
  }, 3000);
  
  // Agregar funcionalidad a botones de cantidad usando delegaci√≥n de eventos
  // Usar CAPTURE phase para ejecutar ANTES que los onclick inline
  document.addEventListener('click', function(e) {
    // Verificar si el click es en un bot√≥n o en su icono
    let btn = e.target.closest('button');
    if (!btn) {
      // Si es un span dentro de un bot√≥n
      const span = e.target.closest('span.material-symbols-outlined');
      if (span) {
        btn = span.closest('button');
      }
    }
    
    if (!btn) return;
    
    // Verificar si el bot√≥n tiene onclick o data attribute que indique que ya tiene manejador
    const hasOnclick = btn.getAttribute('onclick');
    const hasDataHandler = btn.dataset.handled === 'true';
    const isProcessing = btn.dataset.processing === 'true';
    
    // Verificar si es un bot√≥n "Agregar" (contiene texto "Agregar") - estos tienen su propio manejador
    const buttonText = btn.textContent || '';
    const isAddButton = buttonText.toLowerCase().includes('agregar');
    
    // Si es un bot√≥n "Agregar", detener la propagaci√≥n y NO procesar
    if (isAddButton) {
      // Detener completamente el evento para que solo el onclick se ejecute
      e.stopImmediatePropagation();
      return;
    }
    
    // Si tiene onclick, NO procesar con el listener global (salir temprano)
    if (hasOnclick || hasDataHandler || isProcessing) {
      return; // Salir temprano para evitar procesamiento adicional
    }
    
    // Buscar el icono dentro del bot√≥n
    const icon = btn.querySelector('span.material-symbols-outlined');
    if (!icon) return;
    
    // Verificar si est√° en un contenedor de cantidad
    const quantityContainer = btn.closest('.flex.flex-col.items-center');
    if (!quantityContainer) return;
    
    // Botones de incrementar (icono "add")
    // Solo procesar si est√° en un contenedor de cantidad y no tiene manejadores adicionales
    if (icon.textContent.trim() === 'add' || icon.textContent.includes('add')) {
      const input = quantityContainer.querySelector('input[type="number"]');
      if (input) {
        e.preventDefault();
        e.stopPropagation();
        const currentValue = parseInt(input.value) || 0;
        input.value = currentValue + 1;
        
        // Actualizar badges del carrito
        updateCartBadges();
        
        // Actualizar totales del carrito y checkout
        updateCartTotals();
      }
    }
    
    // Botones de decrementar (icono "remove")
    // Solo procesar si el bot√≥n NO tiene onclick directo (para evitar doble ejecuci√≥n)
    if ((icon.textContent.trim() === 'remove' || icon.textContent.includes('remove')) && !btn.getAttribute('onclick')) {
      const input = quantityContainer.querySelector('input[type="number"]');
      if (input) {
        e.preventDefault();
        e.stopPropagation();
        const currentValue = parseInt(input.value) || 1;
        if (currentValue > 1) {
          input.value = currentValue - 1;
          
          // Actualizar badges del carrito
          updateCartBadges();
          
          // Actualizar totales del carrito y checkout
          updateCartTotals();
        }
      }
    }
  });
  
  // Event listener delegado para selectores de salsa principal en el carrito
  document.addEventListener('change', function(e) {
    if (e.target && e.target.classList.contains('product-main-sauce')) {
      // Cuando cambia un selector de salsa principal, actualizar totales y visualizaci√≥n en checkout
      updateCartTotals();
      updateCheckoutSauces();
    }
  });
  
  // Permitir Enter para login de admin
  const adminCodeInput = document.getElementById('adminCode');
  if (adminCodeInput) {
    adminCodeInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        handleAdminLogin();
      }
    });
  }
});

// Funciones del Panel de Administraci√≥n
const ADMIN_CODE = '123456'; // C√≥digo de acceso (cambiar por el c√≥digo real)

// ========== FUNCIONES DE FIREBASE PARA STOCK ==========

// Funci√≥n para guardar el estado de stock en Firebase
function saveItemStockStatus(itemName, inStock) {
  if (window.firebaseDB && window.firebaseReady) {
    const stockRef = window.firebaseRef(window.firebaseDB, `stock/${itemName}`);
    window.firebaseSet(stockRef, inStock).catch((error) => {
      console.error('Error al guardar stock en Firebase:', error);
      // Fallback a localStorage
      localStorage.setItem(`stock_${itemName}`, inStock ? 'true' : 'false');
    });
  } else {
    // Fallback a localStorage si Firebase no est√° disponible
    localStorage.setItem(`stock_${itemName}`, inStock ? 'true' : 'false');
  }
}

// Funci√≥n para obtener el estado de stock de Firebase (con callback)
function getItemStockStatus(itemName, callback) {
  if (window.firebaseDB && window.firebaseReady) {
    const stockRef = window.firebaseRef(window.firebaseDB, `stock/${itemName}`);
    window.firebaseGet(stockRef).then((snapshot) => {
      const result = snapshot.exists() ? snapshot.val() : true; // true por defecto
      if (callback) callback(result);
    }).catch((error) => {
      console.error('Error al leer stock:', error);
      // Fallback a localStorage
      const stored = localStorage.getItem(`stock_${itemName}`);
      const result = stored === null ? true : stored === 'true';
      if (callback) callback(result);
    });
  } else {
    // Fallback a localStorage
    const stored = localStorage.getItem(`stock_${itemName}`);
    const result = stored === null ? true : stored === 'true';
    if (callback) callback(result);
  }
}

// Funci√≥n para escuchar cambios en tiempo real del stock
let stockListenerActive = false;
let stockListenerUnsubscribe = null;

function listenToStockChanges(callback) {
  if (!window.firebaseDB || !window.firebaseReady) return;
  
  // Remover listener anterior si existe
  if (stockListenerUnsubscribe) {
    window.firebaseOff(window.firebaseRef(window.firebaseDB, 'stock'), stockListenerUnsubscribe);
  }
  
  const stockRef = window.firebaseRef(window.firebaseDB, 'stock');
  stockListenerUnsubscribe = window.firebaseOnValue(stockRef, (snapshot) => {
    const stockData = snapshot.val() || {};
    if (callback) callback(stockData);
  });
  
  stockListenerActive = true;
}

// Funci√≥n para obtener todo el stock de una vez
function getAllStockStatus(callback) {
  if (window.firebaseDB && window.firebaseReady) {
    const stockRef = window.firebaseRef(window.firebaseDB, 'stock');
    window.firebaseGet(stockRef).then((snapshot) => {
      const stockData = snapshot.val() || {};
      if (callback) callback(stockData);
    }).catch((error) => {
      console.error('Error al leer todo el stock:', error);
      if (callback) callback({});
    });
  } else {
    if (callback) callback({});
  }
}

// Array con todos los items del men√∫ (se carga din√°micamente desde Firebase)
let MENU_ITEMS = [];
let productsListenerUnsubscribe = null;
let currentCategoryFilter = 'all'; // Filtro de categor√≠a actual

// Funci√≥n para cargar productos desde Firebase
function loadProductsFromFirebase(callback) {
  if (!window.firebaseDB || !window.firebaseReady) {
    if (callback) callback([]);
    return;
  }
  
  const productsRef = window.firebaseRef(window.firebaseDB, 'products');
  
  window.firebaseGet(productsRef).then((snapshot) => {
    const productsData = snapshot.val() || {};
    const productsArray = Object.values(productsData);
    
    MENU_ITEMS = productsArray;
    
    if (callback) callback(productsArray);
  }).catch((error) => {
    console.error('Error al cargar productos:', error);
    if (callback) callback([]);
  });
}

// Funci√≥n para escuchar cambios en productos en tiempo real
function listenToProductsChanges(callback) {
  if (!window.firebaseDB || !window.firebaseReady) return;
  
  if (productsListenerUnsubscribe) {
    window.firebaseOff(window.firebaseRef(window.firebaseDB, 'products'), productsListenerUnsubscribe);
  }
  
  const productsRef = window.firebaseRef(window.firebaseDB, 'products');
  productsListenerUnsubscribe = window.firebaseOnValue(productsRef, (snapshot) => {
    const productsData = snapshot.val() || {};
    const productsArray = Object.values(productsData);
    MENU_ITEMS = productsArray;
    if (callback) callback(productsArray);
  });
}

// Funci√≥n para generar los filtros de categor√≠as din√°micamente
function generateCategoryFilters(products) {
  const container = document.getElementById('categoryFiltersContainer');
  if (!container) return;
  
  // Obtener categor√≠as √∫nicas de los productos
  const categories = ['all', ...new Set(products.map(p => p.category).filter(c => c && c !== 'Sin categor√≠a'))];
  
  container.innerHTML = '';
  
  categories.forEach(category => {
    const isActive = currentCategoryFilter === category;
    const displayName = category === 'all' ? 'Todo el Men√∫' : category;
    const chipHTML = `
<div onclick="filterByCategory('${category}')" class="flex h-10 shrink-0 items-center justify-center gap-x-2 rounded-full px-6 cursor-pointer transition-all ${isActive ? 'bg-primary text-white shadow-lg shadow-primary/20' : 'bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 text-gray-700 dark:text-gray-300 hover:bg-zinc-200 dark:hover:bg-zinc-700'}">
<span class="text-sm ${isActive ? 'font-semibold' : 'font-medium'}">${displayName}</span>
</div>
`;
    container.innerHTML += chipHTML;
  });
}

// Funci√≥n para filtrar productos por categor√≠a
function filterByCategory(category) {
  currentCategoryFilter = category;
  // Regenerar filtros con la categor√≠a activa
  generateCategoryFilters(MENU_ITEMS);
  // Regenerar el men√∫ con el filtro aplicado
  generateMenuHTML(MENU_ITEMS);
}

// Funci√≥n para generar las categor√≠as del home con im√°genes reales de productos
function generateHomeCategories(products) {
  const container = document.getElementById('homeCategoriesContainer');
  if (!container) return;
  
  // Obtener categor√≠as √∫nicas (excluir 'Sin categor√≠a')
  const categories = [...new Set(products.map(p => p.category).filter(c => c && c !== 'Sin categor√≠a'))];
  
  container.innerHTML = '';
  
  // Limitar a 4 categor√≠as para el dise√±o del home
  const displayCategories = categories.slice(0, 4);
  
  displayCategories.forEach(category => {
    let categoryImage = '';
    
    // URL espec√≠fica para la categor√≠a "Gohan"
    const gohanImageUrl = 'https://images-cdn.kyte.site/v0/b/kyte-7c484.appspot.com/o/EGgbMOFFpKckghElVUHQn6vbYF82%2Fthumb_280_11f60fe9-f263-44d1-be80-a8b1fba7556d.jpg?alt=media';
    
    // Si la categor√≠a es "Gohan", usar la URL espec√≠fica
    const normalizedCategory = (category || '').toLowerCase().trim();
    if (normalizedCategory.includes('gohan')) {
      categoryImage = gohanImageUrl;
    } else {
      // Buscar el primer producto de esta categor√≠a que tenga imagen
      const categoryProduct = products.find(p => p.category === category && p.imageUrl && p.imageUrl.trim() !== '');
      
      // Si no hay producto con imagen, usar placeholder
      categoryImage = categoryProduct 
        ? categoryProduct.imageUrl 
        : getPlaceholderImage(category, category);
    }
    
    const categoryHTML = `
<div onclick="router.navigate('menu'); filterByCategory('${category}');" class="flex flex-col gap-3 rounded-2xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-zinc-900 p-4 items-center justify-center text-center shadow-sm hover:border-primary transition-all group cursor-pointer">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full w-16 shrink-0 shadow-md group-hover:scale-105 transition-transform" data-alt="${category}" style="background-image: url('${categoryImage}'); background-color: #b5352c;"></div>
<h2 class="text-[#171212] dark:text-white text-sm font-bold leading-tight">${category}</h2>
</div>
`;
    container.innerHTML += categoryHTML;
  });
}

// Funci√≥n para actualizar la imagen del slide de promoci√≥n con una imagen de productos de promociones
function updatePromoHeroSlide(products) {
  const promoSlide = document.getElementById('promoHeroSlide');
  if (!promoSlide) return;
  
  // Buscar productos de la categor√≠a "promociones"
  const promoProducts = products.filter(p => {
    const category = (p.category || '').toLowerCase().trim();
    return category.includes('promocion') || category === 'promociones';
  });
  
  // Si hay productos de promociones con imagen, usar la primera imagen disponible
  if (promoProducts.length > 0) {
    const promoWithImage = promoProducts.find(p => p.imageUrl && p.imageUrl.trim() !== '');
    if (promoWithImage && promoWithImage.imageUrl) {
      const imageUrl = promoWithImage.imageUrl;
      promoSlide.style.backgroundImage = `linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0.7)), url('${imageUrl}')`;
      return;
    }
  }
  
  // Si no hay productos de promociones con imagen, mantener la imagen por defecto
  // (ya est√° configurada en el HTML)
}

// Funci√≥n para generar "Elecci√≥n del Chef" con productos destacados
function generateChefChoice(products) {
  const container = document.getElementById('chefChoiceContainer');
  if (!container) return;
  
  container.innerHTML = '';
  
  if (products.length === 0) return;
  
  // Filtrar productos marcados como "Elecci√≥n del Chef" (isChefChoice === true)
  let featuredProducts = products.filter(p => p.isChefChoice === true);
  
  // Si no hay productos marcados como "Elecci√≥n del Chef", usar fallback:
  // Productos con badge "Chef's Pick" o similares
  if (featuredProducts.length === 0) {
    featuredProducts = products.filter(p => p.badge && (p.badge.toLowerCase().includes('chef') || p.badge.toLowerCase().includes('pick')));
  }
  
  // Si a√∫n no hay productos, tomar los primeros 3 productos que tengan im√°genes
  if (featuredProducts.length === 0) {
    featuredProducts = products.filter(p => p.imageUrl && p.imageUrl.trim() !== '').slice(0, 3);
  } else {
    // Limitar a 3 productos (los primeros que est√©n marcados como Chef)
    featuredProducts = featuredProducts.slice(0, 3);
  }
  
  // Si a√∫n no hay suficientes, completar con cualquier producto que tenga imagen
  while (featuredProducts.length < 3 && featuredProducts.length < products.length) {
    const remaining = products.filter(p => !featuredProducts.includes(p) && p.imageUrl && p.imageUrl.trim() !== '');
    if (remaining.length > 0) {
      featuredProducts.push(remaining[0]);
    } else {
      break;
    }
  }
  
  featuredProducts.forEach((product, index) => {
    const hasImage = product.imageUrl && product.imageUrl.trim() !== '';
    const imageUrl = hasImage ? product.imageUrl : getPlaceholderImage(product.name, product.category);
    
    // El primer producto ocupa 2 filas en m√≥vil, 1 en desktop
    const isFirst = index === 0;
    const itemClass = isFirst ? 'row-span-2 lg:row-span-1' : '';
    const bottomClass = isFirst ? 'bottom-4 left-4 right-4' : 'bottom-3 left-3';
    const nameClass = isFirst ? 'text-xs font-semibold mb-1' : 'text-[10px] font-semibold';
    const priceClass = isFirst ? 'text-primary font-bold' : 'text-primary text-xs font-bold';
    
    const itemHTML = `
<div onclick="selectProduct('${(product.name || '').replace(/'/g, "\\'").replace(/"/g, '&quot;')}'); router.navigate('product');" class="${itemClass} relative rounded-2xl overflow-hidden shadow-lg bg-zinc-100 dark:bg-zinc-800 cursor-pointer hover:scale-[1.02] transition-transform" data-alt="${product.alt || product.name || ''}" style="background-image: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0.8)), url('${imageUrl}'); background-size: cover; background-color: #b5352c;">
<div class="absolute ${bottomClass}">
<p class="text-white ${nameClass}">${product.name}</p>
<p class="${priceClass}">${formatPrice(product.price)}</p>
</div>
</div>
`;
    container.innerHTML += itemHTML;
  });
}

// Funci√≥n para generar el HTML del men√∫ din√°micamente
function generateMenuHTML(products) {
  const container = document.getElementById('menuProductsContainer');
  if (!container) return;
  
  container.innerHTML = '';
  
  if (products.length === 0) {
    container.innerHTML = '<div class="col-span-full text-center text-gray-400 p-8">No hay productos disponibles</div>';
    return;
  }
  
  // Filtrar productos por categor√≠a si no es 'all'
  let filteredProducts = currentCategoryFilter === 'all' 
    ? products 
    : products.filter(p => p.category === currentCategoryFilter);
  
  if (filteredProducts.length === 0) {
    container.innerHTML = '<div class="col-span-full text-center text-gray-400 p-8">No hay productos en esta categor√≠a</div>';
    return;
  }
  
  // Ordenar productos por categor√≠a seg√∫n el orden especificado (se aplica siempre, incluso cuando el filtro es 'all')
  const categoryOrder = [
    'sushi burger',  // Coincide con "Sushi burger" en la BD (la normalizaci√≥n maneja may√∫sculas y espacios)
    'gohan',
    'sushipleto',
    'fries',
    'bebestibles',
    'promociones',
    'salsas'
  ];
  
  // Funci√≥n para normalizar una categor√≠a (min√∫sculas, sin espacios, sin acentos)
  const normalizeCategory = (category) => {
    if (!category) return '';
    return category
      .toLowerCase()
      .trim()
      .replace(/\s+/g, '') // Eliminar todos los espacios
      .normalize('NFD') // Normalizar caracteres Unicode (separar acentos)
      .replace(/[\u0300-\u036f]/g, ''); // Eliminar diacr√≠ticos (acentos)
  };
  
  // Funci√≥n para obtener el √≠ndice de orden de una categor√≠a
  const getCategoryOrder = (category) => {
    if (!category) return 999;
    
    const normalizedCategory = normalizeCategory(category);
    
    // Buscar coincidencia exacta primero (m√°s preciso)
    let index = categoryOrder.findIndex(cat => {
      const catNormalized = normalizeCategory(cat);
      return normalizedCategory === catNormalized;
    });
    
    // Si no hay coincidencia exacta, buscar coincidencia parcial (que contenga la palabra clave)
    if (index === -1) {
      index = categoryOrder.findIndex(cat => {
        const catNormalized = normalizeCategory(cat);
        // Coincidencia si la categor√≠a normalizada contiene la palabra clave o viceversa
        return normalizedCategory.includes(catNormalized) || catNormalized.includes(normalizedCategory);
      });
    }
    
    // Si no se encuentra, asignar un √≠ndice alto para que aparezca al final
    return index === -1 ? 999 : index;
  };
  
  // Ordenar productos: primero por categor√≠a seg√∫n categoryOrder, luego por nombre alfab√©ticamente
  filteredProducts = filteredProducts.sort((a, b) => {
    const orderA = getCategoryOrder(a.category);
    const orderB = getCategoryOrder(b.category);
    
    // Primero ordenar por √≠ndice de categor√≠a (seg√∫n categoryOrder)
    if (orderA !== orderB) {
      return orderA - orderB;
    }
    
    // Si tienen el mismo orden de categor√≠a, ordenar por nombre alfab√©ticamente
    const nameA = (a.name || '').toLowerCase().trim();
    const nameB = (b.name || '').toLowerCase().trim();
    return nameA.localeCompare(nameB);
  });
  
  filteredProducts.forEach((product) => {
    const badgeHTML = product.badge ? `<div class="absolute top-2 left-2 ${getBadgeClass(product.badge)} px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider ${getBadgeTextClass(product.badge)}">${product.badge}</div>` : '';
    
    // Imagen de fondo o imagen referencial si no hay imagen
    // Verificar si la URL es base64 o una URL normal
    const imageUrlRaw = product.imageUrl || '';
    const hasImage = imageUrlRaw.trim() !== '' && (
      imageUrlRaw.startsWith('http://') || 
      imageUrlRaw.startsWith('https://') || 
      imageUrlRaw.startsWith('data:image')
    );
    const imageUrl = hasImage ? imageUrlRaw : getPlaceholderImage(product.name, product.category);
    
    // Escapar el nombre del producto para HTML
    const safeProductName = (product.name || '').replace(/'/g, "\\'").replace(/"/g, '&quot;');
    
    const itemHTML = `
<div class="flex flex-col gap-2 group">
<div onclick="selectProduct('${safeProductName}'); router.navigate('product');" class="relative w-full aspect-[4/5] bg-center bg-no-repeat bg-cover rounded-xl shadow-sm border border-zinc-100 dark:border-zinc-800 overflow-hidden cursor-pointer hover:scale-[1.02] transition-transform" data-alt="${product.alt || product.name || ''}" style="background-image: url('${imageUrl}'); background-color: #b5352c;">
<img src="${imageUrl}" alt="${safeProductName}" class="absolute inset-0 w-full h-full object-cover opacity-0" onerror="this.onerror=null; this.style.display='none'; this.parentElement.style.backgroundImage='linear-gradient(135deg, #b5352c 0%, #8b2922 100%)';">
${badgeHTML}
</div>
<div class="flex flex-col flex-1 justify-between pt-1">
<div>
<h3 class="text-[#171212] dark:text-white text-sm font-bold leading-tight">${product.name}</h3>
<p class="text-[#836967] dark:text-zinc-400 text-xs font-medium mt-0.5">${formatPrice(product.price)}</p>
</div>
<button onclick="event.stopImmediatePropagation(); addToCartDirect(this, event); return false;" class="mt-2 flex items-center justify-center gap-2 w-full py-2 bg-primary text-white rounded-lg text-xs font-bold transition-transform active:scale-95 shadow-md shadow-primary/20">
<span class="material-symbols-outlined text-sm">add</span> Agregar
</button>
</div>
</div>
`;
    container.innerHTML += itemHTML;
  });
  
  // Actualizar estado de stock despu√©s de generar el men√∫
  setTimeout(() => {
    updateMenuStockStatus();
  }, 300);
}

// Funci√≥n para obtener URL de imagen referencial cuando no hay imagen
function getPlaceholderImage(productName, category) {
  // Generar un hash simple del nombre del producto para obtener una imagen consistente
  let hash = 0;
  const nameStr = (productName || category || 'food').toLowerCase();
  for (let i = 0; i < nameStr.length; i++) {
    const char = nameStr.charCodeAt(i);
    hash = ((hash << 5) - hash) + char;
    hash = hash & hash;
  }
  const seed = Math.abs(hash);
  
  // Determinar categor√≠a de imagen seg√∫n el producto usando Foodish API
  const name = nameStr;
  let foodCategory = 'burger'; // Default
  
  if (name.includes('burger') || name.includes('hamburguesa')) {
    foodCategory = 'burger';
  } else if (name.includes('sushi') || name.includes('roll')) {
    foodCategory = 'sushi';
  } else if (name.includes('pizza')) {
    foodCategory = 'pizza';
  } else if (name.includes('pasta')) {
    foodCategory = 'pasta';
  } else if (name.includes('dosa')) {
    foodCategory = 'dosa';
  } else if (name.includes('idly')) {
    foodCategory = 'idly';
  } else if (name.includes('vada')) {
    foodCategory = 'vada';
  } else if (name.includes('samosa')) {
    foodCategory = 'samosa';
  } else if (name.includes('biryani')) {
    foodCategory = 'biryani';
  } else if (name.includes('butter') || name.includes('chicken')) {
    foodCategory = 'butter_chicken';
  } else {
    // Si no coincide, usar el seed para variar entre categor√≠as disponibles
    const categories = ['burger', 'sushi', 'pizza', 'pasta', 'samosa'];
    foodCategory = categories[seed % categories.length];
  }
  
  // Generar URL de imagen referencial
  // Usar placeholder.com que siempre funciona como fallback
  const width = 400;
  const height = 500;
  const bgColor = 'b5352c'; // Color primario del sitio
  const textColor = 'ffffff';
  const displayName = (productName || 'Producto').substring(0, 20); // Limitar texto
  
  // Intentar usar Unsplash primero, pero con fallback a placeholder
  const searchTerm = encodeURIComponent(foodCategory || 'food');
  const unsplashUrl = `https://source.unsplash.com/${width}x${height}/?${searchTerm}&sig=${seed}`;
  
  // Usar placeholder.com que es m√°s confiable
  // Esto mostrar√° al menos un fondo con el nombre del producto
  const placeholderUrl = `https://via.placeholder.com/${width}x${height}/${bgColor}/${textColor}?text=${encodeURIComponent(displayName)}`;
  
  // Tambi√©n intentar con Unsplash para obtener im√°genes reales de comida
  // El navegador intentar√° cargar la imagen y si falla, usar√° el onerror del img tag
  return `https://images.unsplash.com/photo-${1500 + (seed % 1000)}?w=${width}&h=${height}&fit=crop&auto=format&q=80`;
}

// Funci√≥n para formatear precios sin s√≠mbolo $ y sin decimales innecesarios
function formatPrice(price) {
  const numPrice = parseFloat(price) || 0;
  // Si es un n√∫mero entero, mostrarlo sin decimales; si tiene decimales, mostrarlos solo si no son .00
  if (numPrice % 1 === 0) {
    return numPrice.toString();
  } else {
    // Si termina en .00, mostrarlo sin decimales
    const rounded = Math.round(numPrice * 100) / 100;
    if (rounded % 1 === 0) {
      return rounded.toString();
    }
    return rounded.toString();
  }
}

// Funci√≥n auxiliar para clases de badge
function getBadgeClass(badge) {
  const badgeLower = badge.toLowerCase();
  if (badgeLower.includes('chef') || badgeLower.includes("pick")) return 'bg-white/90 dark:bg-black/80 text-primary';
  if (badgeLower.includes('vegetariano') || badgeLower.includes('vegetarian')) return 'bg-[#6B705C]/90 text-white';
  return 'bg-primary/90 text-white';
}

function getBadgeTextClass(badge) {
  const badgeLower = badge.toLowerCase();
  if (badgeLower.includes('chef') || badgeLower.includes("pick")) return 'text-primary';
  return 'text-white';
}

// Funci√≥n para generar la lista de inventario en el panel admin
function generateAdminInventory() {
  const inventoryList = document.getElementById('adminInventoryList');
  if (!inventoryList) return;
  
  // Cargar productos desde Firebase
  loadProductsFromFirebase((products) => {
    // Actualizar contador de items
    const itemsCountEl = document.getElementById('adminItemsCount');
    if (itemsCountEl) {
      itemsCountEl.textContent = `${products.length} ITEMS TOTALES`;
    }
    
    // Limpiar contenido existente
    inventoryList.innerHTML = '';
    
    if (products.length === 0) {
      inventoryList.innerHTML = '<div class="text-center text-gray-400 p-8">No hay productos disponibles. Usa import-excel.html para importar productos.</div>';
      return;
    }
    
    // Cargar stock desde Firebase para cada item
    products.forEach((item, index) => {
      getItemStockStatus(item.name, (inStock) => {
        const isChecked = inStock ? 'checked=""' : '';
        const stockStatus = inStock ? 'En Stock' : 'Agotado';
        const stockClass = inStock ? 'text-accent-green' : 'text-primary';
        const toggleBg = inStock ? 'bg-accent-green' : 'bg-primary';
        const opacityClass = inStock ? '' : 'opacity-60';
        const contentOpacityClass = inStock ? '' : 'opacity-60';
        
        // Verificar si el producto est√° marcado como "Elecci√≥n del Chef"
        const isChefChoice = item.isChefChoice === true;
        const chefChoiceChecked = isChefChoice ? 'checked=""' : '';
        const chefChoiceBg = isChefChoice ? 'bg-yellow-500' : 'bg-gray-300';
        
        const itemHTML = `
<!-- Item ${index + 1} -->
<div class="flex items-center gap-4 bg-white dark:bg-gray-900 rounded-xl p-3 shadow-sm border border-gray-100 dark:border-gray-800 ${opacityClass}" data-product-name="${(item.name || '').replace(/"/g, '&quot;')}">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-16 shrink-0" data-alt="${item.alt || ''}" style="background-image: url('${item.imageUrl || ''}');"></div>
<div class="flex flex-col flex-1 min-w-0 ${contentOpacityClass}">
<p class="font-display text-base font-bold truncate">${item.name}</p>
<p class="text-gray-500 text-sm">${formatPrice(item.price)} ‚Ä¢ ${item.category || 'Sin categor√≠a'}</p>
<div class="flex items-center gap-2 mt-1">
<p class="${stockClass} text-xs font-bold uppercase tracking-tighter">${stockStatus}</p>
${isChefChoice ? '<span class="text-yellow-600 dark:text-yellow-400 text-xs font-bold">‚≠ê Chef</span>' : ''}
</div>
</div>
<div class="flex flex-col gap-2 shrink-0 items-end">
<label class="relative flex h-[34px] w-[60px] cursor-pointer items-center rounded-full p-1 transition-colors duration-300 toggle-label ${toggleBg}" title="Stock">
<input ${isChecked} class="invisible absolute toggle-checkbox peer" type="checkbox" onchange="toggleItemStock(this)"/>
<div class="h-full w-[26px] rounded-full bg-white transition-all peer-checked:translate-x-[26px]" style="box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
</label>
<label class="relative flex h-[28px] w-[50px] cursor-pointer items-center rounded-full p-1 transition-colors duration-300 toggle-label ${chefChoiceBg}" title="Elecci√≥n del Chef">
<input ${chefChoiceChecked} class="invisible absolute toggle-checkbox peer" type="checkbox" onchange="toggleChefChoice(this)"/>
<div class="h-full w-[22px] rounded-full bg-white transition-all peer-checked:translate-x-[22px]" style="box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
</label>
</div>
</div>
`;
        
        inventoryList.innerHTML += itemHTML;
      });
    });
  });
}

// Funci√≥n para manejar el login del administrador
function handleAdminLogin() {
  const codeInput = document.getElementById('adminCode');
  const errorMsg = document.getElementById('adminCodeError');
  
  if (!codeInput) return;
  
  const enteredCode = codeInput.value.trim();
  
  if (enteredCode === ADMIN_CODE) {
    // C√≥digo correcto - establecer sesi√≥n
    sessionStorage.setItem('adminAuthenticated', 'true');
    
    // Limpiar error si existe
    if (errorMsg) {
      errorMsg.classList.add('hidden');
    }
    
    // Limpiar campo
    codeInput.value = '';
    
    // Navegar al panel de admin
    router.navigate('admin');
  } else {
    // C√≥digo incorrecto - mostrar error
    if (errorMsg) {
      errorMsg.classList.remove('hidden');
    }
    
    // Limpiar campo y enfocar
    codeInput.value = '';
    setTimeout(() => {
      codeInput.focus();
    }, 100);
  }
}

// Funci√≥n para actualizar el estado de stock en el men√∫ del usuario
function updateMenuStockStatus() {
  const menuGrid = document.querySelector('.products-grid');
  if (!menuGrid) return;
  
  // Configurar listener en tiempo real si Firebase est√° disponible
  if (window.firebaseDB && window.firebaseReady && !stockListenerActive) {
    listenToStockChanges((stockData) => {
      applyStockStatusToMenu(stockData);
    });
  } else {
    // Fallback: cargar estado actual sin listener
    const menuItems = menuGrid.querySelectorAll('.flex.flex-col.gap-2.group');
    menuItems.forEach(itemContainer => {
      const nameEl = itemContainer.querySelector('h3');
      if (!nameEl) return;
      
      const productName = nameEl.textContent.trim();
      getItemStockStatus(productName, (isInStock) => {
        applyStockToItem(itemContainer, productName, isInStock);
      });
    });
  }
}

// Funci√≥n para aplicar el estado de stock a todo el men√∫ desde datos de Firebase
function applyStockStatusToMenu(stockData) {
  const menuGrid = document.querySelector('.products-grid');
  if (!menuGrid) return;
  
  const menuItems = menuGrid.querySelectorAll('.flex.flex-col.gap-2.group');
  menuItems.forEach(itemContainer => {
    const nameEl = itemContainer.querySelector('h3');
    if (!nameEl) return;
    
    const productName = nameEl.textContent.trim();
    const isInStock = stockData[productName] !== undefined ? stockData[productName] : true;
    applyStockToItem(itemContainer, productName, isInStock);
  });
}

// Funci√≥n para aplicar el estado de stock a un item individual
function applyStockToItem(itemContainer, productName, isInStock) {
  const addButton = itemContainer.querySelector('button[onclick*="addToCartDirect"]');
  const imageDiv = itemContainer.querySelector('div[onclick]');
  
  if (isInStock) {
    // En stock - habilitar bot√≥n y quitar opacidad
    if (addButton) {
      addButton.disabled = false;
      addButton.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-gray-400');
      addButton.classList.add('bg-primary', 'cursor-pointer', 'active:scale-95');
      addButton.innerHTML = '<span class="material-symbols-outlined text-sm">add</span> Agregar';
    }
    if (imageDiv) {
      imageDiv.classList.remove('opacity-50');
      itemContainer.classList.remove('opacity-60');
    }
    
    // Remover badge de agotado si existe
    const outOfStockBadge = itemContainer.querySelector('.out-of-stock-badge');
    if (outOfStockBadge) {
      outOfStockBadge.remove();
    }
  } else {
    // Agotado - deshabilitar bot√≥n y aplicar estilos
    if (addButton) {
      addButton.disabled = true;
      addButton.classList.remove('bg-primary', 'cursor-pointer', 'active:scale-95');
      addButton.classList.add('opacity-50', 'cursor-not-allowed', 'bg-gray-400');
      addButton.innerHTML = '<span class="material-symbols-outlined text-sm">block</span> Agotado';
    }
    if (imageDiv) {
      imageDiv.classList.add('opacity-50');
      itemContainer.classList.add('opacity-60');
      
      // Agregar badge de agotado si no existe
      if (!imageDiv.querySelector('.out-of-stock-badge')) {
        const badge = document.createElement('div');
        badge.className = 'out-of-stock-badge absolute top-2 right-2 bg-red-600 text-white px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider z-10';
        badge.textContent = 'Agotado';
        imageDiv.appendChild(badge);
      }
    }
  }
}

// Funci√≥n para toggle de stock de items
function toggleItemStock(checkbox) {
  const itemContainer = checkbox.closest('.bg-white, .dark\\:bg-gray-900');
  if (!itemContainer) return;
  
  const isChecked = checkbox.checked;
  const statusEl = itemContainer.querySelector('.text-accent-green, .text-primary');
  const toggleLabel = checkbox.parentElement;
  
  // Obtener el nombre del producto
  const productNameEl = itemContainer.querySelector('.font-display.text-base.font-bold');
  const productName = productNameEl ? productNameEl.textContent.trim() : '';
  
  if (statusEl) {
    if (isChecked) {
      // En stock
      statusEl.textContent = 'En Stock';
      statusEl.classList.remove('text-primary');
      statusEl.classList.add('text-accent-green');
      itemContainer.classList.remove('opacity-60', 'opacity-70');
      toggleLabel.classList.remove('bg-primary');
      toggleLabel.classList.add('bg-accent-green');
    } else {
      // Agotado
      statusEl.textContent = 'Agotado';
      statusEl.classList.remove('text-accent-green');
      statusEl.classList.add('text-primary');
      itemContainer.classList.add('opacity-60');
      toggleLabel.classList.remove('bg-accent-green');
      toggleLabel.classList.add('bg-primary');
    }
  }
  
  // Guardar en Firebase
  if (productName) {
    saveItemStockStatus(productName, isChecked);
    // Actualizar el men√∫ del usuario si est√° visible (el listener en tiempo real lo har√° autom√°ticamente, pero esto es un backup)
    setTimeout(() => {
      updateMenuStockStatus();
    }, 200);
  }
}

// Funci√≥n para toggle de "Elecci√≥n del Chef"
function toggleChefChoice(checkbox) {
  const itemContainer = checkbox.closest('.bg-white, .dark\\:bg-gray-900');
  if (!itemContainer) return;
  
  const isChecked = checkbox.checked;
  const toggleLabel = checkbox.parentElement;
  
  // Obtener el nombre del producto desde data attribute o texto
  const productName = itemContainer.getAttribute('data-product-name') || 
                      itemContainer.querySelector('.font-display.text-base.font-bold')?.textContent.trim() || '';
  
  if (!productName) return;
  
  // Actualizar UI del toggle
  if (isChecked) {
    toggleLabel.classList.remove('bg-gray-300');
    toggleLabel.classList.add('bg-yellow-500');
    // Agregar badge de "Chef" si no existe
    const statusContainer = itemContainer.querySelector('.flex.items-center.gap-2.mt-1');
    if (statusContainer && !statusContainer.querySelector('.text-yellow-600')) {
      const chefBadge = document.createElement('span');
      chefBadge.className = 'text-yellow-600 dark:text-yellow-400 text-xs font-bold';
      chefBadge.textContent = '‚≠ê Chef';
      statusContainer.appendChild(chefBadge);
    }
  } else {
    toggleLabel.classList.remove('bg-yellow-500');
    toggleLabel.classList.add('bg-gray-300');
    // Remover badge de "Chef"
    const chefBadge = itemContainer.querySelector('.text-yellow-600');
    if (chefBadge) {
      chefBadge.remove();
    }
  }
  
  // Guardar en Firebase
  saveProductChefChoice(productName, isChecked);
  
  // Actualizar "Elecci√≥n del Chef" en el home
  setTimeout(() => {
    loadProductsFromFirebase((products) => {
      generateChefChoice(products);
    });
  }, 200);
}

// Funci√≥n para guardar el estado de "Elecci√≥n del Chef" en Firebase
function saveProductChefChoice(productName, isChefChoice) {
  if (!window.firebaseDB || !window.firebaseReady) {
    console.error('Firebase no est√° disponible');
    return;
  }
  
  // Buscar el producto en Firebase y actualizar su campo isChefChoice
  const productsRef = window.firebaseRef(window.firebaseDB, 'products');
  
  window.firebaseGet(productsRef).then((snapshot) => {
    const productsData = snapshot.val() || {};
    
    // Buscar el producto por nombre
    let productKey = null;
    for (const key in productsData) {
      if (productsData[key].name === productName) {
        productKey = key;
        break;
      }
    }
    
    if (productKey) {
      // Actualizar solo el campo isChefChoice del producto
      const productRef = window.firebaseRef(window.firebaseDB, `products/${productKey}/isChefChoice`);
      window.firebaseSet(productRef, isChefChoice).catch((error) => {
        console.error('Error al guardar isChefChoice en Firebase:', error);
      });
    } else {
      console.warn(`Producto "${productName}" no encontrado en Firebase`);
    }
  }).catch((error) => {
    console.error('Error al leer productos de Firebase:', error);
  });
}

// Variable global para el producto seleccionado
let selectedProductName = null;

// Funci√≥n para seleccionar un producto antes de navegar
function selectProduct(productName) {
  selectedProductName = productName;
  sessionStorage.setItem('selectedProductName', productName);
}

// Funci√≥n para cargar y mostrar los detalles del producto
function loadProductDetails() {
  // Obtener el nombre del producto desde sessionStorage o variable global
  const productName = sessionStorage.getItem('selectedProductName') || selectedProductName;
  
  if (!productName) {
    console.warn('No hay producto seleccionado');
    // Si no hay producto, volver al men√∫
    setTimeout(() => {
      router.navigate('menu');
    }, 500);
    return;
  }
  
  // Limpiar contenido anterior para evitar duplicados
  const imageEl = document.getElementById('productImage');
  const nameEl = document.getElementById('productName');
  const priceEl = document.getElementById('productPrice');
  const descEl = document.getElementById('productDescription');
  const badgeEl = document.getElementById('productBadge');
  const ingredientsContainer = document.getElementById('productIngredientsContainer');
  
  // Resetear a estado de carga
  if (imageEl) {
    imageEl.style.backgroundImage = '';
  }
  if (nameEl) {
    nameEl.textContent = 'Cargando...';
  }
  if (priceEl) {
    priceEl.textContent = '$0';
  }
  if (descEl) {
    descEl.textContent = 'Cargando descripci√≥n...';
  }
  if (badgeEl) {
    badgeEl.classList.add('hidden');
  }
  if (ingredientsContainer) {
    ingredientsContainer.innerHTML = '';
  }
  
  // Cargar productos desde Firebase
  loadProductsFromFirebase((products) => {
    // Buscar el producto por nombre
    const product = products.find(p => p.name === productName);
    
    if (!product) {
      console.warn(`Producto "${productName}" no encontrado`);
      setTimeout(() => {
        router.navigate('menu');
      }, 500);
      return;
    }
    
    // Actualizar la imagen - evitar duplicados limpiando primero
    if (imageEl) {
      const imageUrlRaw = product.imageUrl || '';
      const hasImage = imageUrlRaw.trim() !== '' && (
        imageUrlRaw.startsWith('http://') || 
        imageUrlRaw.startsWith('https://') || 
        imageUrlRaw.startsWith('data:image')
      );
      const imageUrl = hasImage ? imageUrlRaw : getPlaceholderImage(product.name, product.category || '');
      
      imageEl.style.backgroundImage = `url('${imageUrl}')`;
      imageEl.setAttribute('data-alt', product.alt || product.name || '');
    }
    
    // Actualizar nombre
    if (nameEl) {
      nameEl.textContent = product.name || 'Producto';
    }
    
    // Actualizar precio
    if (priceEl) {
      priceEl.textContent = formatPrice(product.price);
    }
    
    // Actualizar badge (si existe)
    if (badgeEl) {
      if (product.badge || product.isChefChoice) {
        badgeEl.textContent = product.badge || 'Elecci√≥n del Chef';
        badgeEl.classList.remove('hidden');
      } else {
        badgeEl.classList.add('hidden');
      }
    }
    
    // Actualizar descripci√≥n
    if (descEl) {
      // Si hay descripci√≥n en el producto, usarla; si no, usar una descripci√≥n por defecto
      if (product.description) {
        descEl.textContent = product.description;
      } else if (product.ingredients && product.ingredients.length > 0) {
        descEl.textContent = `Una deliciosa opci√≥n con ${product.ingredients.join(', ').toLowerCase()}.`;
      } else {
        descEl.textContent = `Disfruta de nuestro ${product.name}, elaborado con ingredientes frescos y de la m√°s alta calidad.`;
      }
    }
    
    // Actualizar ingredientes - limpiar contenido anterior primero
    if (ingredientsContainer) {
      ingredientsContainer.innerHTML = '';
      
      // Si hay ingredientes en el producto, mostrarlos
      if (product.ingredients && Array.isArray(product.ingredients) && product.ingredients.length > 0) {
        const sectionHTML = `
<section>
<h3 class="text-[#171212] dark:text-white text-lg font-bold pb-3">Ingredientes</h3>
<div class="grid grid-cols-1 gap-3">
${product.ingredients.map(ingredient => {
  // Iconos seg√∫n tipo de ingrediente
  let icon = 'nutrition';
  let iconColor = 'green-600';
  let bgColor = 'green-100';
  
  const ingredientLower = (ingredient || '').toLowerCase();
  if (ingredientLower.includes('salsa') || ingredientLower.includes('mayo')) {
    icon = 'liquor';
    iconColor = 'orange-600';
    bgColor = 'orange-100';
  } else if (ingredientLower.includes('picante') || ingredientLower.includes('spicy')) {
    icon = 'local_fire_department';
    iconColor = 'red-600';
    bgColor = 'red-100';
  } else if (ingredientLower.includes('tempura') || ingredientLower.includes('crunch')) {
    icon = 'grain';
    iconColor = 'yellow-600';
    bgColor = 'yellow-100';
  }
  
  return `
<div class="flex items-center gap-3 p-4 rounded-xl border border-[#171212]/10 dark:border-white/10 bg-white dark:bg-white/5">
<div class="w-10 h-10 rounded-lg bg-${bgColor} flex items-center justify-center text-${iconColor}">
<span class="material-symbols-outlined">${icon}</span>
</div>
<div>
<p class="font-bold text-sm dark:text-white">${ingredient || ''}</p>
</div>
</div>`;
}).join('')}
</div>
</section>
`;
        ingredientsContainer.innerHTML = sectionHTML;
      } else {
        // Si no hay ingredientes espec√≠ficos, mostrar mensaje
        ingredientsContainer.innerHTML = `
<section>
<h3 class="text-[#171212] dark:text-white text-lg font-bold pb-3">Descripci√≥n</h3>
<p class="text-[#171212]/70 dark:text-white/70 text-base font-normal leading-relaxed">
Este producto est√° elaborado con ingredientes frescos y de la m√°s alta calidad.
</p>
</section>
`;
      }
      
      // Agregar bot√≥n de "Agregar al carrito" al final
      const buttonSection = `
<div class="h-4"></div>
<section class="sticky bottom-0 bg-background-light dark:bg-background-dark pt-4 pb-6">
<button onclick="addProductToCartFromDetail()" class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 px-6 rounded-xl shadow-lg shadow-primary/25 hover:shadow-xl hover:shadow-primary/30 flex items-center justify-center gap-3 transition-all active:scale-[0.98] text-base">
<span class="material-symbols-outlined">add_shopping_cart</span>
<span>Agregar al Carrito - ${formatPrice(product.price)}</span>
</button>
</section>
`;
      ingredientsContainer.innerHTML += buttonSection;
    }
  });
}

// Funci√≥n para agregar producto al carrito desde la p√°gina de detalle
function addProductToCartFromDetail() {
  const productName = sessionStorage.getItem('selectedProductName') || selectedProductName;
  
  if (!productName) {
    alert('Error: No hay producto seleccionado');
    return;
  }
  
  loadProductsFromFirebase((products) => {
    const product = products.find(p => p.name === productName);
    
    if (!product) {
      alert('Error: Producto no encontrado');
      return;
    }
    
    // Verificar stock antes de agregar
    getItemStockStatus(productName, (isInStock) => {
      if (!isInStock) {
        alert('Este producto est√° actualmente agotado');
        return;
      }
      
      // Agregar al carrito usando la funci√≥n existente
      addProductToCartInternal(productName, product.price || 0);
      
      // Navegar al carrito
      router.navigate('orders');
    });
  });
}
</script>
</body>
</html>